(()=>{var e={973:(e,t,n)=>{var o;!function(){"use strict";var s=function(){this.init()};s.prototype={init:function(){var e=this||r;return e._counter=1e3,e._html5AudioPool=[],e.html5PoolSize=10,e._codecs={},e._howls=[],e._muted=!1,e._volume=1,e._canPlayEvent="canplaythrough",e._navigator="undefined"!=typeof window&&window.navigator?window.navigator:null,e.masterGain=null,e.noAudio=!1,e.usingWebAudio=!0,e.autoSuspend=!0,e.ctx=null,e.autoUnlock=!0,e._setup(),e},volume:function(e){var t=this||r;if(e=parseFloat(e),t.ctx||h(),void 0!==e&&e>=0&&e<=1){if(t._volume=e,t._muted)return t;t.usingWebAudio&&t.masterGain.gain.setValueAtTime(e,r.ctx.currentTime);for(var n=0;n<t._howls.length;n++)if(!t._howls[n]._webAudio)for(var o=t._howls[n]._getSoundIds(),s=0;s<o.length;s++){var i=t._howls[n]._soundById(o[s]);i&&i._node&&(i._node.volume=i._volume*e)}return t}return t._volume},mute:function(e){var t=this||r;t.ctx||h(),t._muted=e,t.usingWebAudio&&t.masterGain.gain.setValueAtTime(e?0:t._volume,r.ctx.currentTime);for(var n=0;n<t._howls.length;n++)if(!t._howls[n]._webAudio)for(var o=t._howls[n]._getSoundIds(),s=0;s<o.length;s++){var i=t._howls[n]._soundById(o[s]);i&&i._node&&(i._node.muted=!!e||i._muted)}return t},stop:function(){for(var e=this||r,t=0;t<e._howls.length;t++)e._howls[t].stop();return e},unload:function(){for(var e=this||r,t=e._howls.length-1;t>=0;t--)e._howls[t].unload();return e.usingWebAudio&&e.ctx&&void 0!==e.ctx.close&&(e.ctx.close(),e.ctx=null,h()),e},codecs:function(e){return(this||r)._codecs[e.replace(/^x-/,"")]},_setup:function(){var e=this||r;if(e.state=e.ctx&&e.ctx.state||"suspended",e._autoSuspend(),!e.usingWebAudio)if("undefined"!=typeof Audio)try{void 0===(new Audio).oncanplaythrough&&(e._canPlayEvent="canplay")}catch(t){e.noAudio=!0}else e.noAudio=!0;try{(new Audio).muted&&(e.noAudio=!0)}catch(e){}return e.noAudio||e._setupCodecs(),e},_setupCodecs:function(){var e=this||r,t=null;try{t="undefined"!=typeof Audio?new Audio:null}catch(t){return e}if(!t||"function"!=typeof t.canPlayType)return e;var n=t.canPlayType("audio/mpeg;").replace(/^no$/,""),o=e._navigator?e._navigator.userAgent:"",s=o.match(/OPR\/([0-6].)/g),i=s&&parseInt(s[0].split("/")[1],10)<33,a=-1!==o.indexOf("Safari")&&-1===o.indexOf("Chrome"),u=o.match(/Version\/(.*?) /),d=a&&u&&parseInt(u[1],10)<15;return e._codecs={mp3:!(i||!n&&!t.canPlayType("audio/mp3;").replace(/^no$/,"")),mpeg:!!n,opus:!!t.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!t.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!t.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(t.canPlayType('audio/wav; codecs="1"')||t.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!t.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!t.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(t.canPlayType("audio/x-m4a;")||t.canPlayType("audio/m4a;")||t.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(t.canPlayType("audio/x-m4b;")||t.canPlayType("audio/m4b;")||t.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(t.canPlayType("audio/x-mp4;")||t.canPlayType("audio/mp4;")||t.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!(d||!t.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!(d||!t.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!t.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(t.canPlayType("audio/x-flac;")||t.canPlayType("audio/flac;")).replace(/^no$/,"")},e},_unlockAudio:function(){var e=this||r;if(!e._audioUnlocked&&e.ctx){e._audioUnlocked=!1,e.autoUnlock=!1,e._mobileUnloaded||44100===e.ctx.sampleRate||(e._mobileUnloaded=!0,e.unload()),e._scratchBuffer=e.ctx.createBuffer(1,1,22050);var t=function(n){for(;e._html5AudioPool.length<e.html5PoolSize;)try{var o=new Audio;o._unlocked=!0,e._releaseHtml5Audio(o)}catch(n){e.noAudio=!0;break}for(var s=0;s<e._howls.length;s++)if(!e._howls[s]._webAudio)for(var r=e._howls[s]._getSoundIds(),i=0;i<r.length;i++){var a=e._howls[s]._soundById(r[i]);a&&a._node&&!a._node._unlocked&&(a._node._unlocked=!0,a._node.load())}e._autoResume();var u=e.ctx.createBufferSource();u.buffer=e._scratchBuffer,u.connect(e.ctx.destination),void 0===u.start?u.noteOn(0):u.start(0),"function"==typeof e.ctx.resume&&e.ctx.resume(),u.onended=function(){u.disconnect(0),e._audioUnlocked=!0,document.removeEventListener("touchstart",t,!0),document.removeEventListener("touchend",t,!0),document.removeEventListener("click",t,!0),document.removeEventListener("keydown",t,!0);for(var n=0;n<e._howls.length;n++)e._howls[n]._emit("unlock")}};return document.addEventListener("touchstart",t,!0),document.addEventListener("touchend",t,!0),document.addEventListener("click",t,!0),document.addEventListener("keydown",t,!0),e}},_obtainHtml5Audio:function(){var e=this||r;if(e._html5AudioPool.length)return e._html5AudioPool.pop();var t=(new Audio).play();return t&&"undefined"!=typeof Promise&&(t instanceof Promise||"function"==typeof t.then)&&t.catch((function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")})),new Audio},_releaseHtml5Audio:function(e){var t=this||r;return e._unlocked&&t._html5AudioPool.push(e),t},_autoSuspend:function(){var e=this;if(e.autoSuspend&&e.ctx&&void 0!==e.ctx.suspend&&r.usingWebAudio){for(var t=0;t<e._howls.length;t++)if(e._howls[t]._webAudio)for(var n=0;n<e._howls[t]._sounds.length;n++)if(!e._howls[t]._sounds[n]._paused)return e;return e._suspendTimer&&clearTimeout(e._suspendTimer),e._suspendTimer=setTimeout((function(){if(e.autoSuspend){e._suspendTimer=null,e.state="suspending";var t=function(){e.state="suspended",e._resumeAfterSuspend&&(delete e._resumeAfterSuspend,e._autoResume())};e.ctx.suspend().then(t,t)}}),3e4),e}},_autoResume:function(){var e=this;if(e.ctx&&void 0!==e.ctx.resume&&r.usingWebAudio)return"running"===e.state&&"interrupted"!==e.ctx.state&&e._suspendTimer?(clearTimeout(e._suspendTimer),e._suspendTimer=null):"suspended"===e.state||"running"===e.state&&"interrupted"===e.ctx.state?(e.ctx.resume().then((function(){e.state="running";for(var t=0;t<e._howls.length;t++)e._howls[t]._emit("resume")})),e._suspendTimer&&(clearTimeout(e._suspendTimer),e._suspendTimer=null)):"suspending"===e.state&&(e._resumeAfterSuspend=!0),e}};var r=new s,i=function(e){e.src&&0!==e.src.length?this.init(e):console.error("An array of source files must be passed with any new Howl.")};i.prototype={init:function(e){var t=this;return r.ctx||h(),t._autoplay=e.autoplay||!1,t._format="string"!=typeof e.format?e.format:[e.format],t._html5=e.html5||!1,t._muted=e.mute||!1,t._loop=e.loop||!1,t._pool=e.pool||5,t._preload="boolean"!=typeof e.preload&&"metadata"!==e.preload||e.preload,t._rate=e.rate||1,t._sprite=e.sprite||{},t._src="string"!=typeof e.src?e.src:[e.src],t._volume=void 0!==e.volume?e.volume:1,t._xhr={method:e.xhr&&e.xhr.method?e.xhr.method:"GET",headers:e.xhr&&e.xhr.headers?e.xhr.headers:null,withCredentials:!(!e.xhr||!e.xhr.withCredentials)&&e.xhr.withCredentials},t._duration=0,t._state="unloaded",t._sounds=[],t._endTimers={},t._queue=[],t._playLock=!1,t._onend=e.onend?[{fn:e.onend}]:[],t._onfade=e.onfade?[{fn:e.onfade}]:[],t._onload=e.onload?[{fn:e.onload}]:[],t._onloaderror=e.onloaderror?[{fn:e.onloaderror}]:[],t._onplayerror=e.onplayerror?[{fn:e.onplayerror}]:[],t._onpause=e.onpause?[{fn:e.onpause}]:[],t._onplay=e.onplay?[{fn:e.onplay}]:[],t._onstop=e.onstop?[{fn:e.onstop}]:[],t._onmute=e.onmute?[{fn:e.onmute}]:[],t._onvolume=e.onvolume?[{fn:e.onvolume}]:[],t._onrate=e.onrate?[{fn:e.onrate}]:[],t._onseek=e.onseek?[{fn:e.onseek}]:[],t._onunlock=e.onunlock?[{fn:e.onunlock}]:[],t._onresume=[],t._webAudio=r.usingWebAudio&&!t._html5,void 0!==r.ctx&&r.ctx&&r.autoUnlock&&r._unlockAudio(),r._howls.push(t),t._autoplay&&t._queue.push({event:"play",action:function(){t.play()}}),t._preload&&"none"!==t._preload&&t.load(),t},load:function(){var e=this,t=null;if(!r.noAudio){"string"==typeof e._src&&(e._src=[e._src]);for(var n=0;n<e._src.length;n++){var o,s;if(e._format&&e._format[n])o=e._format[n];else{if("string"!=typeof(s=e._src[n])){e._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}(o=/^data:audio\/([^;,]+);/i.exec(s))||(o=/\.([^.]+)$/.exec(s.split("?",1)[0])),o&&(o=o[1].toLowerCase())}if(o||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),o&&r.codecs(o)){t=e._src[n];break}}return t?(e._src=t,e._state="loading","https:"===window.location.protocol&&"http:"===t.slice(0,5)&&(e._html5=!0,e._webAudio=!1),new a(e),e._webAudio&&d(e),e):void e._emit("loaderror",null,"No codec support for selected audio sources.")}e._emit("loaderror",null,"No audio support.")},play:function(e,t){var n=this,o=null;if("number"==typeof e)o=e,e=null;else{if("string"==typeof e&&"loaded"===n._state&&!n._sprite[e])return null;if(void 0===e&&(e="__default",!n._playLock)){for(var s=0,i=0;i<n._sounds.length;i++)n._sounds[i]._paused&&!n._sounds[i]._ended&&(s++,o=n._sounds[i]._id);1===s?e=null:o=null}}var a=o?n._soundById(o):n._inactiveSound();if(!a)return null;if(o&&!e&&(e=a._sprite||"__default"),"loaded"!==n._state){a._sprite=e,a._ended=!1;var u=a._id;return n._queue.push({event:"play",action:function(){n.play(u)}}),u}if(o&&!a._paused)return t||n._loadQueue("play"),a._id;n._webAudio&&r._autoResume();var d=Math.max(0,a._seek>0?a._seek:n._sprite[e][0]/1e3),l=Math.max(0,(n._sprite[e][0]+n._sprite[e][1])/1e3-d),c=1e3*l/Math.abs(a._rate),_=n._sprite[e][0]/1e3,h=(n._sprite[e][0]+n._sprite[e][1])/1e3;a._sprite=e,a._ended=!1;var f=function(){a._paused=!1,a._seek=d,a._start=_,a._stop=h,a._loop=!(!a._loop&&!n._sprite[e][2])};if(!(d>=h)){var p=a._node;if(n._webAudio){var m=function(){n._playLock=!1,f(),n._refreshBuffer(a);var e=a._muted||n._muted?0:a._volume;p.gain.setValueAtTime(e,r.ctx.currentTime),a._playStart=r.ctx.currentTime,void 0===p.bufferSource.start?a._loop?p.bufferSource.noteGrainOn(0,d,86400):p.bufferSource.noteGrainOn(0,d,l):a._loop?p.bufferSource.start(0,d,86400):p.bufferSource.start(0,d,l),c!==1/0&&(n._endTimers[a._id]=setTimeout(n._ended.bind(n,a),c)),t||setTimeout((function(){n._emit("play",a._id),n._loadQueue()}),0)};"running"===r.state&&"interrupted"!==r.ctx.state?m():(n._playLock=!0,n.once("resume",m),n._clearTimer(a._id))}else{var v=function(){p.currentTime=d,p.muted=a._muted||n._muted||r._muted||p.muted,p.volume=a._volume*r.volume(),p.playbackRate=a._rate;try{var o=p.play();if(o&&"undefined"!=typeof Promise&&(o instanceof Promise||"function"==typeof o.then)?(n._playLock=!0,f(),o.then((function(){n._playLock=!1,p._unlocked=!0,t?n._loadQueue():n._emit("play",a._id)})).catch((function(){n._playLock=!1,n._emit("playerror",a._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),a._ended=!0,a._paused=!0}))):t||(n._playLock=!1,f(),n._emit("play",a._id)),p.playbackRate=a._rate,p.paused)return void n._emit("playerror",a._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");"__default"!==e||a._loop?n._endTimers[a._id]=setTimeout(n._ended.bind(n,a),c):(n._endTimers[a._id]=function(){n._ended(a),p.removeEventListener("ended",n._endTimers[a._id],!1)},p.addEventListener("ended",n._endTimers[a._id],!1))}catch(e){n._emit("playerror",a._id,e)}};"data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"===p.src&&(p.src=n._src,p.load());var y=window&&window.ejecta||!p.readyState&&r._navigator.isCocoonJS;if(p.readyState>=3||y)v();else{n._playLock=!0,n._state="loading";var g=function(){n._state="loaded",v(),p.removeEventListener(r._canPlayEvent,g,!1)};p.addEventListener(r._canPlayEvent,g,!1),n._clearTimer(a._id)}}return a._id}n._ended(a)},pause:function(e){var t=this;if("loaded"!==t._state||t._playLock)return t._queue.push({event:"pause",action:function(){t.pause(e)}}),t;for(var n=t._getSoundIds(e),o=0;o<n.length;o++){t._clearTimer(n[o]);var s=t._soundById(n[o]);if(s&&!s._paused&&(s._seek=t.seek(n[o]),s._rateSeek=0,s._paused=!0,t._stopFade(n[o]),s._node))if(t._webAudio){if(!s._node.bufferSource)continue;void 0===s._node.bufferSource.stop?s._node.bufferSource.noteOff(0):s._node.bufferSource.stop(0),t._cleanBuffer(s._node)}else isNaN(s._node.duration)&&s._node.duration!==1/0||s._node.pause();arguments[1]||t._emit("pause",s?s._id:null)}return t},stop:function(e,t){var n=this;if("loaded"!==n._state||n._playLock)return n._queue.push({event:"stop",action:function(){n.stop(e)}}),n;for(var o=n._getSoundIds(e),s=0;s<o.length;s++){n._clearTimer(o[s]);var r=n._soundById(o[s]);r&&(r._seek=r._start||0,r._rateSeek=0,r._paused=!0,r._ended=!0,n._stopFade(o[s]),r._node&&(n._webAudio?r._node.bufferSource&&(void 0===r._node.bufferSource.stop?r._node.bufferSource.noteOff(0):r._node.bufferSource.stop(0),n._cleanBuffer(r._node)):isNaN(r._node.duration)&&r._node.duration!==1/0||(r._node.currentTime=r._start||0,r._node.pause(),r._node.duration===1/0&&n._clearSound(r._node))),t||n._emit("stop",r._id))}return n},mute:function(e,t){var n=this;if("loaded"!==n._state||n._playLock)return n._queue.push({event:"mute",action:function(){n.mute(e,t)}}),n;if(void 0===t){if("boolean"!=typeof e)return n._muted;n._muted=e}for(var o=n._getSoundIds(t),s=0;s<o.length;s++){var i=n._soundById(o[s]);i&&(i._muted=e,i._interval&&n._stopFade(i._id),n._webAudio&&i._node?i._node.gain.setValueAtTime(e?0:i._volume,r.ctx.currentTime):i._node&&(i._node.muted=!!r._muted||e),n._emit("mute",i._id))}return n},volume:function(){var e,t,n,o=this,s=arguments;if(0===s.length)return o._volume;if(1===s.length||2===s.length&&void 0===s[1]?o._getSoundIds().indexOf(s[0])>=0?t=parseInt(s[0],10):e=parseFloat(s[0]):s.length>=2&&(e=parseFloat(s[0]),t=parseInt(s[1],10)),!(void 0!==e&&e>=0&&e<=1))return(n=t?o._soundById(t):o._sounds[0])?n._volume:0;if("loaded"!==o._state||o._playLock)return o._queue.push({event:"volume",action:function(){o.volume.apply(o,s)}}),o;void 0===t&&(o._volume=e),t=o._getSoundIds(t);for(var i=0;i<t.length;i++)(n=o._soundById(t[i]))&&(n._volume=e,s[2]||o._stopFade(t[i]),o._webAudio&&n._node&&!n._muted?n._node.gain.setValueAtTime(e,r.ctx.currentTime):n._node&&!n._muted&&(n._node.volume=e*r.volume()),o._emit("volume",n._id));return o},fade:function(e,t,n,o){var s=this;if("loaded"!==s._state||s._playLock)return s._queue.push({event:"fade",action:function(){s.fade(e,t,n,o)}}),s;e=Math.min(Math.max(0,parseFloat(e)),1),t=Math.min(Math.max(0,parseFloat(t)),1),n=parseFloat(n),s.volume(e,o);for(var i=s._getSoundIds(o),a=0;a<i.length;a++){var u=s._soundById(i[a]);if(u){if(o||s._stopFade(i[a]),s._webAudio&&!u._muted){var d=r.ctx.currentTime,l=d+n/1e3;u._volume=e,u._node.gain.setValueAtTime(e,d),u._node.gain.linearRampToValueAtTime(t,l)}s._startFadeInterval(u,e,t,n,i[a],void 0===o)}}return s},_startFadeInterval:function(e,t,n,o,s,r){var i=this,a=t,u=n-t,d=Math.abs(u/.01),l=Math.max(4,d>0?o/d:o),c=Date.now();e._fadeTo=n,e._interval=setInterval((function(){var s=(Date.now()-c)/o;c=Date.now(),a+=u*s,a=Math.round(100*a)/100,a=u<0?Math.max(n,a):Math.min(n,a),i._webAudio?e._volume=a:i.volume(a,e._id,!0),r&&(i._volume=a),(n<t&&a<=n||n>t&&a>=n)&&(clearInterval(e._interval),e._interval=null,e._fadeTo=null,i.volume(n,e._id),i._emit("fade",e._id))}),l)},_stopFade:function(e){var t=this,n=t._soundById(e);return n&&n._interval&&(t._webAudio&&n._node.gain.cancelScheduledValues(r.ctx.currentTime),clearInterval(n._interval),n._interval=null,t.volume(n._fadeTo,e),n._fadeTo=null,t._emit("fade",e)),t},loop:function(){var e,t,n,o=this,s=arguments;if(0===s.length)return o._loop;if(1===s.length){if("boolean"!=typeof s[0])return!!(n=o._soundById(parseInt(s[0],10)))&&n._loop;e=s[0],o._loop=e}else 2===s.length&&(e=s[0],t=parseInt(s[1],10));for(var r=o._getSoundIds(t),i=0;i<r.length;i++)(n=o._soundById(r[i]))&&(n._loop=e,o._webAudio&&n._node&&n._node.bufferSource&&(n._node.bufferSource.loop=e,e&&(n._node.bufferSource.loopStart=n._start||0,n._node.bufferSource.loopEnd=n._stop,o.playing(r[i])&&(o.pause(r[i],!0),o.play(r[i],!0)))));return o},rate:function(){var e,t,n,o=this,s=arguments;if(0===s.length)t=o._sounds[0]._id;else if(1===s.length){var i=o._getSoundIds(),a=i.indexOf(s[0]);a>=0?t=parseInt(s[0],10):e=parseFloat(s[0])}else 2===s.length&&(e=parseFloat(s[0]),t=parseInt(s[1],10));if("number"!=typeof e)return(n=o._soundById(t))?n._rate:o._rate;if("loaded"!==o._state||o._playLock)return o._queue.push({event:"rate",action:function(){o.rate.apply(o,s)}}),o;void 0===t&&(o._rate=e),t=o._getSoundIds(t);for(var u=0;u<t.length;u++)if(n=o._soundById(t[u])){o.playing(t[u])&&(n._rateSeek=o.seek(t[u]),n._playStart=o._webAudio?r.ctx.currentTime:n._playStart),n._rate=e,o._webAudio&&n._node&&n._node.bufferSource?n._node.bufferSource.playbackRate.setValueAtTime(e,r.ctx.currentTime):n._node&&(n._node.playbackRate=e);var d=o.seek(t[u]),l=(o._sprite[n._sprite][0]+o._sprite[n._sprite][1])/1e3-d,c=1e3*l/Math.abs(n._rate);!o._endTimers[t[u]]&&n._paused||(o._clearTimer(t[u]),o._endTimers[t[u]]=setTimeout(o._ended.bind(o,n),c)),o._emit("rate",n._id)}return o},seek:function(){var e,t,n=this,o=arguments;if(0===o.length)n._sounds.length&&(t=n._sounds[0]._id);else if(1===o.length){var s=n._getSoundIds(),i=s.indexOf(o[0]);i>=0?t=parseInt(o[0],10):n._sounds.length&&(t=n._sounds[0]._id,e=parseFloat(o[0]))}else 2===o.length&&(e=parseFloat(o[0]),t=parseInt(o[1],10));if(void 0===t)return 0;if("number"==typeof e&&("loaded"!==n._state||n._playLock))return n._queue.push({event:"seek",action:function(){n.seek.apply(n,o)}}),n;var a=n._soundById(t);if(a){if(!("number"==typeof e&&e>=0)){if(n._webAudio){var u=n.playing(t)?r.ctx.currentTime-a._playStart:0,d=a._rateSeek?a._rateSeek-a._seek:0;return a._seek+(d+u*Math.abs(a._rate))}return a._node.currentTime}var l=n.playing(t);l&&n.pause(t,!0),a._seek=e,a._ended=!1,n._clearTimer(t),n._webAudio||!a._node||isNaN(a._node.duration)||(a._node.currentTime=e);var c=function(){l&&n.play(t,!0),n._emit("seek",t)};if(l&&!n._webAudio){var _=function(){n._playLock?setTimeout(_,0):c()};setTimeout(_,0)}else c()}return n},playing:function(e){var t=this;if("number"==typeof e){var n=t._soundById(e);return!!n&&!n._paused}for(var o=0;o<t._sounds.length;o++)if(!t._sounds[o]._paused)return!0;return!1},duration:function(e){var t=this,n=t._duration,o=t._soundById(e);return o&&(n=t._sprite[o._sprite][1]/1e3),n},state:function(){return this._state},unload:function(){for(var e=this,t=e._sounds,n=0;n<t.length;n++)t[n]._paused||e.stop(t[n]._id),e._webAudio||(e._clearSound(t[n]._node),t[n]._node.removeEventListener("error",t[n]._errorFn,!1),t[n]._node.removeEventListener(r._canPlayEvent,t[n]._loadFn,!1),t[n]._node.removeEventListener("ended",t[n]._endFn,!1),r._releaseHtml5Audio(t[n]._node)),delete t[n]._node,e._clearTimer(t[n]._id);var o=r._howls.indexOf(e);o>=0&&r._howls.splice(o,1);var s=!0;for(n=0;n<r._howls.length;n++)if(r._howls[n]._src===e._src||e._src.indexOf(r._howls[n]._src)>=0){s=!1;break}return u&&s&&delete u[e._src],r.noAudio=!1,e._state="unloaded",e._sounds=[],e=null,null},on:function(e,t,n,o){var s=this["_on"+e];return"function"==typeof t&&s.push(o?{id:n,fn:t,once:o}:{id:n,fn:t}),this},off:function(e,t,n){var o=this,s=o["_on"+e],r=0;if("number"==typeof t&&(n=t,t=null),t||n)for(r=0;r<s.length;r++){var i=n===s[r].id;if(t===s[r].fn&&i||!t&&i){s.splice(r,1);break}}else if(e)o["_on"+e]=[];else{var a=Object.keys(o);for(r=0;r<a.length;r++)0===a[r].indexOf("_on")&&Array.isArray(o[a[r]])&&(o[a[r]]=[])}return o},once:function(e,t,n){return this.on(e,t,n,1),this},_emit:function(e,t,n){for(var o=this,s=o["_on"+e],r=s.length-1;r>=0;r--)s[r].id&&s[r].id!==t&&"load"!==e||(setTimeout(function(e){e.call(this,t,n)}.bind(o,s[r].fn),0),s[r].once&&o.off(e,s[r].fn,s[r].id));return o._loadQueue(e),o},_loadQueue:function(e){var t=this;if(t._queue.length>0){var n=t._queue[0];n.event===e&&(t._queue.shift(),t._loadQueue()),e||n.action()}return t},_ended:function(e){var t=this,n=e._sprite;if(!t._webAudio&&e._node&&!e._node.paused&&!e._node.ended&&e._node.currentTime<e._stop)return setTimeout(t._ended.bind(t,e),100),t;var o=!(!e._loop&&!t._sprite[n][2]);if(t._emit("end",e._id),!t._webAudio&&o&&t.stop(e._id,!0).play(e._id),t._webAudio&&o){t._emit("play",e._id),e._seek=e._start||0,e._rateSeek=0,e._playStart=r.ctx.currentTime;var s=1e3*(e._stop-e._start)/Math.abs(e._rate);t._endTimers[e._id]=setTimeout(t._ended.bind(t,e),s)}return t._webAudio&&!o&&(e._paused=!0,e._ended=!0,e._seek=e._start||0,e._rateSeek=0,t._clearTimer(e._id),t._cleanBuffer(e._node),r._autoSuspend()),t._webAudio||o||t.stop(e._id,!0),t},_clearTimer:function(e){var t=this;if(t._endTimers[e]){if("function"!=typeof t._endTimers[e])clearTimeout(t._endTimers[e]);else{var n=t._soundById(e);n&&n._node&&n._node.removeEventListener("ended",t._endTimers[e],!1)}delete t._endTimers[e]}return t},_soundById:function(e){for(var t=this,n=0;n<t._sounds.length;n++)if(e===t._sounds[n]._id)return t._sounds[n];return null},_inactiveSound:function(){var e=this;e._drain();for(var t=0;t<e._sounds.length;t++)if(e._sounds[t]._ended)return e._sounds[t].reset();return new a(e)},_drain:function(){var e=this,t=e._pool,n=0,o=0;if(!(e._sounds.length<t)){for(o=0;o<e._sounds.length;o++)e._sounds[o]._ended&&n++;for(o=e._sounds.length-1;o>=0;o--){if(n<=t)return;e._sounds[o]._ended&&(e._webAudio&&e._sounds[o]._node&&e._sounds[o]._node.disconnect(0),e._sounds.splice(o,1),n--)}}},_getSoundIds:function(e){if(void 0===e){for(var t=[],n=0;n<this._sounds.length;n++)t.push(this._sounds[n]._id);return t}return[e]},_refreshBuffer:function(e){return e._node.bufferSource=r.ctx.createBufferSource(),e._node.bufferSource.buffer=u[this._src],e._panner?e._node.bufferSource.connect(e._panner):e._node.bufferSource.connect(e._node),e._node.bufferSource.loop=e._loop,e._loop&&(e._node.bufferSource.loopStart=e._start||0,e._node.bufferSource.loopEnd=e._stop||0),e._node.bufferSource.playbackRate.setValueAtTime(e._rate,r.ctx.currentTime),this},_cleanBuffer:function(e){var t=r._navigator&&r._navigator.vendor.indexOf("Apple")>=0;if(r._scratchBuffer&&e.bufferSource&&(e.bufferSource.onended=null,e.bufferSource.disconnect(0),t))try{e.bufferSource.buffer=r._scratchBuffer}catch(e){}return e.bufferSource=null,this},_clearSound:function(e){/MSIE |Trident\//.test(r._navigator&&r._navigator.userAgent)||(e.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var a=function(e){this._parent=e,this.init()};a.prototype={init:function(){var e=this,t=e._parent;return e._muted=t._muted,e._loop=t._loop,e._volume=t._volume,e._rate=t._rate,e._seek=0,e._paused=!0,e._ended=!0,e._sprite="__default",e._id=++r._counter,t._sounds.push(e),e.create(),e},create:function(){var e=this,t=e._parent,n=r._muted||e._muted||e._parent._muted?0:e._volume;return t._webAudio?(e._node=void 0===r.ctx.createGain?r.ctx.createGainNode():r.ctx.createGain(),e._node.gain.setValueAtTime(n,r.ctx.currentTime),e._node.paused=!0,e._node.connect(r.masterGain)):r.noAudio||(e._node=r._obtainHtml5Audio(),e._errorFn=e._errorListener.bind(e),e._node.addEventListener("error",e._errorFn,!1),e._loadFn=e._loadListener.bind(e),e._node.addEventListener(r._canPlayEvent,e._loadFn,!1),e._endFn=e._endListener.bind(e),e._node.addEventListener("ended",e._endFn,!1),e._node.src=t._src,e._node.preload=!0===t._preload?"auto":t._preload,e._node.volume=n*r.volume(),e._node.load()),e},reset:function(){var e=this,t=e._parent;return e._muted=t._muted,e._loop=t._loop,e._volume=t._volume,e._rate=t._rate,e._seek=0,e._rateSeek=0,e._paused=!0,e._ended=!0,e._sprite="__default",e._id=++r._counter,e},_errorListener:function(){var e=this;e._parent._emit("loaderror",e._id,e._node.error?e._node.error.code:0),e._node.removeEventListener("error",e._errorFn,!1)},_loadListener:function(){var e=this,t=e._parent;t._duration=Math.ceil(10*e._node.duration)/10,0===Object.keys(t._sprite).length&&(t._sprite={__default:[0,1e3*t._duration]}),"loaded"!==t._state&&(t._state="loaded",t._emit("load"),t._loadQueue()),e._node.removeEventListener(r._canPlayEvent,e._loadFn,!1)},_endListener:function(){var e=this,t=e._parent;t._duration===1/0&&(t._duration=Math.ceil(10*e._node.duration)/10,t._sprite.__default[1]===1/0&&(t._sprite.__default[1]=1e3*t._duration),t._ended(e)),e._node.removeEventListener("ended",e._endFn,!1)}};var u={},d=function(e){var t=e._src;if(u[t])return e._duration=u[t].duration,void _(e);if(/^data:[^;]+;base64,/.test(t)){for(var n=atob(t.split(",")[1]),o=new Uint8Array(n.length),s=0;s<n.length;++s)o[s]=n.charCodeAt(s);c(o.buffer,e)}else{var r=new XMLHttpRequest;r.open(e._xhr.method,t,!0),r.withCredentials=e._xhr.withCredentials,r.responseType="arraybuffer",e._xhr.headers&&Object.keys(e._xhr.headers).forEach((function(t){r.setRequestHeader(t,e._xhr.headers[t])})),r.onload=function(){var t=(r.status+"")[0];"0"===t||"2"===t||"3"===t?c(r.response,e):e._emit("loaderror",null,"Failed loading audio file with status: "+r.status+".")},r.onerror=function(){e._webAudio&&(e._html5=!0,e._webAudio=!1,e._sounds=[],delete u[t],e.load())},l(r)}},l=function(e){try{e.send()}catch(t){e.onerror()}},c=function(e,t){var n=function(){t._emit("loaderror",null,"Decoding audio data failed.")},o=function(e){e&&t._sounds.length>0?(u[t._src]=e,_(t,e)):n()};"undefined"!=typeof Promise&&1===r.ctx.decodeAudioData.length?r.ctx.decodeAudioData(e).then(o).catch(n):r.ctx.decodeAudioData(e,o,n)},_=function(e,t){t&&!e._duration&&(e._duration=t.duration),0===Object.keys(e._sprite).length&&(e._sprite={__default:[0,1e3*e._duration]}),"loaded"!==e._state&&(e._state="loaded",e._emit("load"),e._loadQueue())},h=function(){if(r.usingWebAudio){try{"undefined"!=typeof AudioContext?r.ctx=new AudioContext:"undefined"!=typeof webkitAudioContext?r.ctx=new webkitAudioContext:r.usingWebAudio=!1}catch(e){r.usingWebAudio=!1}r.ctx||(r.usingWebAudio=!1);var e=/iP(hone|od|ad)/.test(r._navigator&&r._navigator.platform),t=r._navigator&&r._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),n=t?parseInt(t[1],10):null;if(e&&n&&n<9){var o=/safari/.test(r._navigator&&r._navigator.userAgent.toLowerCase());r._navigator&&!o&&(r.usingWebAudio=!1)}r.usingWebAudio&&(r.masterGain=void 0===r.ctx.createGain?r.ctx.createGainNode():r.ctx.createGain(),r.masterGain.gain.setValueAtTime(r._muted?0:r._volume,r.ctx.currentTime),r.masterGain.connect(r.ctx.destination)),r._setup()}};void 0!==(o=function(){return{Howler:r,Howl:i}}.apply(t,[]))&&(e.exports=o),void 0!==n.g?(n.g.HowlerGlobal=s,n.g.Howler=r,n.g.Howl=i,n.g.Sound=a):"undefined"!=typeof window&&(window.HowlerGlobal=s,window.Howler=r,window.Howl=i,window.Sound=a)}()}},t={};function n(o){var s=t[o];if(void 0!==s)return s.exports;var r=t[o]={exports:{}};return e[o](r,r.exports,n),r.exports}n.d=(e,t)=>{for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var o={};(()=>{"use strict";function e(e,t){return e+Math.round(Math.random()*(t-e))}function t(e,t){return e+Math.random()*(t-e)}n.d(o,{e:()=>M});class s{static new(e,t){return{x:e,y:t}}static from_angle(e,t=1){return{x:Math.cos(e)*t,y:Math.sin(e)*t}}static angle(e){return Math.atan(e.y/e.x)+Math.PI*(e.x<0)}static add(e,t,n){if(void 0===n)return"number"==typeof t?(e.x+=t,void(e.y+=t)):(e.x+=t.x,void(e.y+=t.y));e.x+=t,e.y+=n}static sub(e,t,n){if(void 0===n)return"number"==typeof t?(e.x-=t,void(e.y-=t)):(e.x-=t.x,void(e.y-=t.y));e.x-=t,e.y-=n}static c_add(e,t,n){const o=s.copy(e);return s.add(o,t,n),o}static pow(e,t,n){if(void 0===n)return"number"==typeof t?(e.x**=t,void(e.y**=t)):(e.x**=t.x,void(e.y**=t.y));e.x**=t,e.y**=n}static mag(e){return Math.sqrt(e.x**2+e.y**2)}static norm(e,t=1){const n=s.mag(e)/t;e.x/=n,e.y/=n}static mult(e,t,n){if(void 0===n)return"number"==typeof t?(e.x*=t,void(e.y*=t)):(e.x*=t.x,void(e.y*=t.y));e.x*=t,e.y*=n}static div(e,t,n){if(void 0===n)return"number"==typeof t?(e.x/=t,void(e.y/=t)):(e.x/=t.x,void(e.y/=t.y));e.x/=t,e.y/=n}static copy(e){return{x:e.x,y:e.y}}}class r{static set(e,t,n){if(n<0||n>15||n%1!=0)throw`Expected int within range 0-15 for Bytewise.set(), received ${n} instead`;const o=4*t;let s=e;return s-=e&15<<o,s+=n<<o,s}static random(t){let n=0;for(let o=0;t>>o>0;o+=4)n+=e(0,t>>o&15)<<o;return n}static get(e,t){return e>>4*t&15}static inc(e,t,n=15){return r.set(e,t,(r.get(e,t)+1)%n)}static dec(e,t,n=15){return r.set(e,t,(r.get(e,t)-1)%n)}static eq(e,t){let n=0;for(let o=0;e>>o>0;o+=4)n+=+((e>>o&15)==(t>>o&15))<<o/4;return n}static add(e,t,n=-1){if(-1==n)return e+t;const o=e|t;let s=0;for(let r=0;o>>r>0;r+=4)s+=((e>>r&15)+(t>>r&15))%n;return s}static star_compare(e,t){let n=0;const o=e|t;for(let s=0;o>>s>0;s+=4){const o=e>>s&15,r=t>>s&15;let i=null;if(o==r?i=o:((0==o&&1==r||0==r&&1==o)&&(i=2),(0==o&&2==r||0==r&&2==o)&&(i=1),(1==o&&2==r||1==r&&2==o)&&(i=0)),null===i)throw`Star comparison critical error! DIGITA=${o}, DIGITB=${r}`;n+=i<<s}return n}}let i=null;const a=128;function u(e,t,n,o,s,u){const d=r.get(t,0)*a,l=r.get(t,2)*a*3+r.get(t,1)*a;if(d>256||l>1024)throw`ValueError: Star has invalid flags! Position resides outside boundaries (${l},${d})`;e.drawImage(i,l,d,a,a,n,o,s,u)}n(973);const d={};globalThis.SOUNDS=d;const l={};function c(e,t){if(!(e in l))throw`ValueError: Attempted to access non-existent channel ${e}`;l[e]=t;for(let n in d)if(d[n].channel===e)for(let e of d[n].howls)e.playing&&e.volume(t)}function _(t){if(!(t in d))throw`ValueError: Attempted to play non-existent sound ${t}`;const n=d[t];if(n.volume*l[n.channel]==0)return;let o=n.volume*l[n.channel];if(n.howls.length>1){let t=e(0,n.howls.length-1);n.howls[t].volume(o),n.howls[t].play()}else n.howls[0].volume(o),n.howls[0].play()}function h(e){return new Promise((t=>{setTimeout(t,e)}))}globalThis.CHANNELS=l,function(e){for(let e of[{name:"connect_succeed",channel:"sfx",sources:[["/assets/sound/connect_succeed1.mp3"],["/assets/sound/connect_succeed2.mp3"],["/assets/sound/connect_succeed3.mp3"]],volume:.5},{name:"connect_fail",channel:"sfx",sources:[["/assets/sound/connect_fail.mp3"]],volume:.5},{name:"complete",channel:"sfx",sources:[["/assets/sound/complete.mp3"]],volume:1},{name:"click",channel:"sfx",sources:[["/assets/sound/click.mp3"]],volume:.4}]){const t=new Array(e.sources.length);for(let n in e.sources)t[n]=new Howl({src:e.sources[n],volume:e.volume});d[e.name]={channel:e.channel,volume:e.volume,howls:t}}}(),function(e){for(let e of[{name:"sfx",volume:.5},{name:"music",volume:1}])l[e.name]=e.volume}();const f=document.querySelector("#background");class p{stars=[];canvas;ctx;space={width:0,height:0};dpi=devicePixelRatio;mouse={x:0,y:0,star_id:null};selection=[];action=0;collected_arr=[];collected=0;difficulty=0;__enable_score=!0;score=0;vscore=0;__events={};__pairstate=[[],new Uint8Array];level_size=[0,5,0];static gravity=1;static gamescale=1.75;static motion=0;static colortable=[[168,100,77],[0,0,500],[327,100,68]];static SetColorMode(e){console.warn("SetColorMode is obsolete!"),p.colortable=e}static SetMusicVolume(e){c("music",e)}static SetSFXVolume(e){c("sfx",e)}static SetGameScale(e){p.gamescale=e,console.warn("SetGameScale is non-functional!")}static SetMotionMode(e){f.classList.toggle("no-motion",e>0),p.motion=e}constructor(e){if(this.stars=[],this.canvas=e,this.ctx=this.canvas.getContext("2d"),null===this.ctx)throw"Context is null! This should never happen.";this.canvas.addEventListener("mousemove",(e=>{this.onmousemove(e)})),this.canvas.addEventListener("mousedown",(e=>{this.onmousedown(e)}))}resize(){const e=this.canvas.clientWidth-this.space.width,t=this.canvas.clientHeight-this.space.height,n=s.new(e/2,t/2);this.stars.forEach((e=>{s.add(e,n)})),this.canvas.width=this.canvas.clientWidth*this.dpi,this.canvas.height=this.canvas.clientHeight*this.dpi,this.space.width=this.canvas.clientWidth,this.space.height=this.canvas.clientHeight}onmousemove(e){this.mouse.x=e.x,this.mouse.y=e.y,this.mouse.star_id=this.nearest_star(this.mouse,-1,24*p.gamescale)}__analyze_pairs(){const e=[],t=new Set;for(let n=0;n<this.stars.length;n++){let o=this.stars[n];if(!o.collected)for(let s=n+1;s<this.stars.length;s++){let i=this.stars[s];if(i.collected)continue;let a=r.star_compare(o.flags,i.flags);for(let o=s+1;o<this.stars.length;o++){let r=this.stars[o];r.collected||r.flags===a&&(t.add(n),t.add(s),t.add(o),e.push(Uint8Array.of(n,s,o)))}}}const n=new Uint8Array(this.stars.length-t.size-this.collected);let o=0;for(let e=0;e<this.stars.length;e++)t.has(e)||this.stars[e].collected||(n[o]=e,o++);return this.__pairstate=[e,n],this.__pairstate}replenish_pairs(e){const t=new Set,n={},o=new Set;for(let e=0;e<this.stars.length;e++){let s=this.stars[e];if(!s.collected)for(let i=e+1;i<this.stars.length;i++){let e=this.stars[i];if(e.collected||o.has(i))continue;let a=r.star_compare(s.flags,e.flags),u=!1;for(let e=i+1;e<this.stars.length;e++){let t=this.stars[e];if(!t.collected&&t.flags==a&&!o.has(e)){u=!0;break}}u?(o.add(s),o.add(e),o.add(a)):(o.add(e),t.add(a),n[a]=(n[a]||0)+1)}}const s=Math.round((0,1,1,(e-0)/1*(t.size-1)+1));const i=Array.from(t).sort(((e,t)=>n[t]>n[e])),a=new Array(3);for(let e=0;e<3;e++)e+s-1<t.size?a[e]=this.__createStar(i[e+s-1]):a[e]=this.__createStar(r.random(546));return Array.prototype.push.apply(this.stars,a),a}repair_broken_pairs(){const e=this.__pairstate[1].length,t=Math.floor(e/2)+e%2*2,n=new Array(t);for(let t=0;t<Math.floor(e/2);t++){const e=this.__pairstate[1][2*t+0],o=this.__pairstate[1][2*t+1];n[t]=this.__createStar(r.star_compare(this.stars[e].flags,this.stars[o].flags))}if(e%2){const e=t-2,o=r.random(273),s=this.stars[e].flags;n[e+1]=this.__createStar(r.add(s,1*o,2)),n[e+2]=this.__createStar(r.add(s,2*o,2))}Array.prototype.push.apply(this.stars,n)}check_pair(e){const t=new Array(3);for(let n=0;n<3;n++){t[n]=new Uint8Array(e.length);for(let o=0;o<e.length;o++)t[n][o]=r.get(this.stars[this.selection[o]].flags,n);const o=new Set(t[n]);if(1!==o.size&&o.size!==e.length)return!1}return!0}onmousedown(e){this.mouse.x=e.x,this.mouse.y=e.y;let t=this.nearest_star(this.mouse,-1,24*p.gamescale);if(null===t)return this.selection=[],void(this.action=0);if(1===this.action){if(this.selection.includes(t))return;if(_("click"),this.selection.push(t),3==this.selection.length){if(!this.check_pair(this.selection))return this.selection=[],this.action=0,void _("connect_fail");this.collected+=this.selection.length,Array.prototype.push.apply(this.collected_arr,this.selection);for(let e=0;e<this.selection.length;e++)this.stars[this.selection[e]].collected=!0;this.collected==this.stars.length&&(_("complete"),this.__fire_event("pre_complete")&&this.next_stage()),_("connect_succeed"),this.__enable_score&&(this.score+=this.determine_score(this.selection)),this.__analyze_pairs(),this.selection=[],this.action=0,this.__pairstate[1].length&&this.repair_broken_pairs()}}else _("click"),this.selection=[t],this.action=1}nearest_star(e,t=-1,n=0){if(0==this.stars.length)return null;const o=new Uint16Array(this.stars.length);let s=null;for(let n=0;n<this.stars.length;n++)o[n]=Math.min((e.x-this.stars[n].x)**2+(e.y-this.stars[n].y)**2,65535),t!==n&&(o[n]<s||null===s)&&!this.stars[n].collected&&(s=o[n]);return null===s||n&&s>n**2?null:o.indexOf(s)}clear_stage(){this.stars=[],this.selection=[],this.collected=0,this.collected_arr=[]}hook(e,t){this.__events[e]=t}unhook(e){e in this.__events&&delete this.__events[e]}__fire_event(e){return!(e in this.__events)||this.__events[e](this)}determine_score(e){let t=50;const n=r.eq(this.stars[e[0]].flags,this.stars[e[1]].flags);return n>>2||(t+=20),n>>1||(t+=30),n>>0||(t+=40),t}async next_stage(){if(await h(500),this.clear_stage(),this.generate_random(...this.level_size),this.__pairstate[1]=new Uint8Array,p.motion>0){for(let e=0;e<50;e++)this.physics(20,!0);this.settle_stars(p.motion<2)}else this.settle_stars(!0)}__createStar(e){const n=this.space;return(o={x:0,y:0,flags:e,velx:0,vely:0,collected:!1,visx:0,visy:0,vscale:2,opacity:100}).x=t(.1,.9)*n.width,o.y=t(.1,.9)*n.height,o;var o}generate_random(t,n,o){this.space;const s=[];for(let t=0;t<n;t++){const t=3,n=new Array(t),o=e(0,7);let i=r.random(546);for(let e=0;e<t;e++){n[e]=this.__createStar(i);for(let e=0;e<3;e++)o>>e&1&&(i=r.inc(i,e,r.get(819,e)))}s.push(n)}const i=new Array(t);for(let e=0;e<t;e++)i[e]=this.__createStar(r.random(546));if(n){const e=s.reduce(((e,t)=>e.concat(t)));Array.prototype.push.apply(this.stars,e)}Array.prototype.push.apply(this.stars,i)}settle_stars(e){const t=s.new(this.space.width/2,this.space.height/2);if(e)for(let e of this.stars)e.visx=1.4*(e.x-t.x)+t.x,e.visy=1.4*(e.y-t.y)+t.y;else for(let e of this.stars)e.visx=e.x,e.visy=e.y}physics(e,t=!1){const n=0==p.motion||t,o=s.new(this.space.width/2,this.space.height/2);if(2!=p.motion||t)for(let t=0;t<this.stars.length;t++){const r=this.stars[t];if(r.collected)r.opacity>0&&(r.opacity=.85*r.opacity-1,r.x=(6*r.x+o.x)/7,r.y=(6*r.y+o.y)/7);else{if(!n)continue;const o=s.new(r.x-this.space.width/2,r.y-this.space.height/2),i=.2/s.mag(o)**.6+.03;s.mult(o,-1e-4*p.gravity),r.velx+=o.x,r.vely+=o.y;const a=s.from_angle(s.angle(o)+1.571+.2,i);r.velx+=a.x,r.vely+=a.y;const u=this.nearest_star(r,t,72);if(null!==u){const e=s.copy(r);s.sub(e,this.stars[u]);const t=s.mag(e);s.norm(e,(96-t)/400),r.velx+=e.x,r.vely+=e.y}r.velx*=.9,r.vely*=.9,r.x+=r.velx*e,r.y+=r.vely*e}}else for(let e of this.stars)e.collected&&e.opacity>0&&(e.opacity-=5)}render(){const e=this.ctx;if(e.clearRect(0,0,this.canvas.width,this.canvas.height),this.selection.length){e.strokeStyle="#888",e.lineWidth=this.dpi,e.beginPath();const t=this.selection[0];e.moveTo(this.stars[t].visx*this.dpi,this.stars[t].visy*this.dpi);for(let t=1;t<this.selection.length;t++)e.lineTo(this.stars[this.selection[t]].visx*this.dpi,this.stars[this.selection[t]].visy*this.dpi);null===this.mouse.star_id?e.lineTo(this.mouse.x*this.dpi,this.mouse.y*this.dpi):e.lineTo(this.stars[this.mouse.star_id].x*this.dpi,this.stars[this.mouse.star_id].y*this.dpi),e.stroke()}for(let t=0;t<this.stars.length;t++){const n=this.stars[t];if(n.opacity<=0)continue;let o=s.new(n.x-this.mouse.x,n.y-this.mouse.y);s.mult(o,-.04*(null!==this.mouse.star_id&&this.mouse.star_id!==t));let r=s.new(n.x,n.y),i=1;this.selection.includes(t)&&(i=1.3,s.add(r,o)),n.visx=(2*n.visx+r.x)/3,n.visy=(2*n.visy+r.y)/3,n.vscale=(2*n.vscale+i)/3;const a=32*n.vscale;e.globalAlpha=n.opacity/100;const d=s.new(n.visx,n.visy),l=a*this.dpi*p.gamescale;s.mult(d,this.dpi),u(e,n.flags,d.x-l/2,d.y-l/2,l,l)}if(this.__enable_score){this.vscore<this.score&&this.vscore++,this.vscore>this.score&&(this.vscore=this.score);const t=this.canvas.width/2;e.globalAlpha=1,e.textBaseline="top",e.fillStyle="#888",e.textAlign="right",e.font=`bold ${15*this.dpi}px "Helvetica Neue"`,e.fillText("SCORE",t-5,10*this.dpi),e.textAlign="left",e.font=`lighter ${15*this.dpi}px "Helvetica Neue"`,e.fillText(this.vscore.toFixed(0),t+5,10*this.dpi)}}}const m=document.querySelector("#tutorial"),v=[{1:"Hello, this is a game about connecting dots.",2:"",3:"The rules are simple -",4:"",5:"A set is composed of three stars that,",6:"for every charactaristic,",7:"are all equal or are all not equal.",ACT0:function(){M.clear_stage(),M.stars=[M.__createStar(0),M.__createStar(273),M.__createStar(546)],M.settle_stars(!0),M.hook("pre_complete",y)}},{1:"There it is!",2:"It's easy, you'll get the hang of it.",ACT0:async function(){await h(200),M.clear_stage(),M.stars=[M.__createStar(18),M.__createStar(18),M.__createStar(18)],M.settle_stars(!0)}},{1:"Who am I to keep you waiting?",2:"You can do this at your own pace.",ACT0:async function(){await h(300),M.generate_random(0,2,0),M.settle_stars(!0),M.hook("pre_complete",w)}}];function y(){for(g++;m.firstChild;)m.removeChild(m.firstChild);let e=0;for(let t in v[g]){if(t.startsWith("ACT")){v[g][t]();continue}e++;const n=document.createElement("span");n.innerText=v[g][t],m.appendChild(n),setTimeout((()=>{n.classList.add("active")}),500*e)}return!1}let g=0;function w(){return m.classList.remove("active"),M.__enable_score=!0,M.score=0,M.unhook("pre_complete"),!0}const x=document.querySelector("#menu"),b=(document.querySelector("#settings-colormode"),document.querySelector("#settings-motion")),A=document.querySelector("#settings-volume-music"),S=document.querySelector("#settings-volume-sfx");let T=!1;const k={volume_music:1,volume_sfx:1,motion:0},L={volume_music:1,volume_sfx:1,motion:0},I=["Full","Reduced","Minimal"],P={"enter-menu":()=>{x.classList.add("main","active"),T=!0,M.dpi=.5,M.resize()},"main-resume":()=>{x.classList.remove("main","active"),T=!1,M.dpi=devicePixelRatio,M.resize()},"main-settings":()=>{x.classList.remove("main"),x.classList.add("settings"),b.innerText=I[k.motion],A.value=k.volume_music.toString(),S.value=k.volume_sfx.toString()},"main-exit":()=>{},"settings-volume-music":e=>{L.volume_music=Number(e),p.SetMusicVolume(L.volume_music)},"settings-volume-sfx":e=>{L.volume_sfx=Number(e),p.SetSFXVolume(L.volume_sfx)},"settings-game-scale":e=>{p.SetGameScale(Number(e)+1)},"settings-motion-prev":()=>{L.motion>0?L.motion--:L.motion=I.length-1,b.innerText=I[L.motion],p.SetMotionMode(L.motion)},"settings-motion-next":()=>{L.motion<I.length-1?L.motion++:L.motion=0,b.innerText=I[L.motion],p.SetMotionMode(L.motion)},"settings-cancel":()=>{x.classList.remove("settings"),x.classList.add("main"),Object.assign(L,k),E()},"settings-apply":()=>{x.classList.remove("settings"),x.classList.add("main"),Object.assign(k,L),E()}};function E(){p.SetMusicVolume(k.volume_music),p.SetSFXVolume(k.volume_sfx),p.SetMotionMode(k.motion)}document.querySelectorAll("*[data-action]").forEach((e=>{const t=e.getAttribute("data-action");e.addEventListener("click",(()=>{P[t]()}))})),document.querySelectorAll("input[data-value]").forEach((e=>{const t=e.getAttribute("data-value");e.addEventListener("input",(()=>{P[t](e.value)}))}));const B=document.querySelector("canvas");window.addEventListener("resize",(()=>{M.resize()}));const M=globalThis.game=new p(B);M.resize(),(async()=>{await async function(){await async function(e){i=await async function(e){return new Promise(((t,n)=>{let o=new Image;o.onload=()=>{t(o)},o.onerror=e=>{n(e)},o.src=e}))}(e)}("/assets/game/sprites_legacy.png")}(),m.classList.add("active"),g=-1,M.__enable_score=!1,y(),C(0)})();let F=0;function C(e){const t=0|e,n=t-F;F=t,n<800&&(M.physics(n/10),M.render()),requestAnimationFrame(C)}})()})();