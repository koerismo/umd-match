(()=>{var e={973:(e,t,o)=>{var n;!function(){"use strict";var s=function(){this.init()};s.prototype={init:function(){var e=this||i;return e._counter=1e3,e._html5AudioPool=[],e.html5PoolSize=10,e._codecs={},e._howls=[],e._muted=!1,e._volume=1,e._canPlayEvent="canplaythrough",e._navigator="undefined"!=typeof window&&window.navigator?window.navigator:null,e.masterGain=null,e.noAudio=!1,e.usingWebAudio=!0,e.autoSuspend=!0,e.ctx=null,e.autoUnlock=!0,e._setup(),e},volume:function(e){var t=this||i;if(e=parseFloat(e),t.ctx||h(),void 0!==e&&e>=0&&e<=1){if(t._volume=e,t._muted)return t;t.usingWebAudio&&t.masterGain.gain.setValueAtTime(e,i.ctx.currentTime);for(var o=0;o<t._howls.length;o++)if(!t._howls[o]._webAudio)for(var n=t._howls[o]._getSoundIds(),s=0;s<n.length;s++){var r=t._howls[o]._soundById(n[s]);r&&r._node&&(r._node.volume=r._volume*e)}return t}return t._volume},mute:function(e){var t=this||i;t.ctx||h(),t._muted=e,t.usingWebAudio&&t.masterGain.gain.setValueAtTime(e?0:t._volume,i.ctx.currentTime);for(var o=0;o<t._howls.length;o++)if(!t._howls[o]._webAudio)for(var n=t._howls[o]._getSoundIds(),s=0;s<n.length;s++){var r=t._howls[o]._soundById(n[s]);r&&r._node&&(r._node.muted=!!e||r._muted)}return t},stop:function(){for(var e=this||i,t=0;t<e._howls.length;t++)e._howls[t].stop();return e},unload:function(){for(var e=this||i,t=e._howls.length-1;t>=0;t--)e._howls[t].unload();return e.usingWebAudio&&e.ctx&&void 0!==e.ctx.close&&(e.ctx.close(),e.ctx=null,h()),e},codecs:function(e){return(this||i)._codecs[e.replace(/^x-/,"")]},_setup:function(){var e=this||i;if(e.state=e.ctx&&e.ctx.state||"suspended",e._autoSuspend(),!e.usingWebAudio)if("undefined"!=typeof Audio)try{void 0===(new Audio).oncanplaythrough&&(e._canPlayEvent="canplay")}catch(t){e.noAudio=!0}else e.noAudio=!0;try{(new Audio).muted&&(e.noAudio=!0)}catch(e){}return e.noAudio||e._setupCodecs(),e},_setupCodecs:function(){var e=this||i,t=null;try{t="undefined"!=typeof Audio?new Audio:null}catch(t){return e}if(!t||"function"!=typeof t.canPlayType)return e;var o=t.canPlayType("audio/mpeg;").replace(/^no$/,""),n=e._navigator?e._navigator.userAgent:"",s=n.match(/OPR\/([0-6].)/g),r=s&&parseInt(s[0].split("/")[1],10)<33,a=-1!==n.indexOf("Safari")&&-1===n.indexOf("Chrome"),u=n.match(/Version\/(.*?) /),d=a&&u&&parseInt(u[1],10)<15;return e._codecs={mp3:!(r||!o&&!t.canPlayType("audio/mp3;").replace(/^no$/,"")),mpeg:!!o,opus:!!t.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!t.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!t.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(t.canPlayType('audio/wav; codecs="1"')||t.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!t.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!t.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(t.canPlayType("audio/x-m4a;")||t.canPlayType("audio/m4a;")||t.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(t.canPlayType("audio/x-m4b;")||t.canPlayType("audio/m4b;")||t.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(t.canPlayType("audio/x-mp4;")||t.canPlayType("audio/mp4;")||t.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!(d||!t.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!(d||!t.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!t.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(t.canPlayType("audio/x-flac;")||t.canPlayType("audio/flac;")).replace(/^no$/,"")},e},_unlockAudio:function(){var e=this||i;if(!e._audioUnlocked&&e.ctx){e._audioUnlocked=!1,e.autoUnlock=!1,e._mobileUnloaded||44100===e.ctx.sampleRate||(e._mobileUnloaded=!0,e.unload()),e._scratchBuffer=e.ctx.createBuffer(1,1,22050);var t=function(o){for(;e._html5AudioPool.length<e.html5PoolSize;)try{var n=new Audio;n._unlocked=!0,e._releaseHtml5Audio(n)}catch(o){e.noAudio=!0;break}for(var s=0;s<e._howls.length;s++)if(!e._howls[s]._webAudio)for(var i=e._howls[s]._getSoundIds(),r=0;r<i.length;r++){var a=e._howls[s]._soundById(i[r]);a&&a._node&&!a._node._unlocked&&(a._node._unlocked=!0,a._node.load())}e._autoResume();var u=e.ctx.createBufferSource();u.buffer=e._scratchBuffer,u.connect(e.ctx.destination),void 0===u.start?u.noteOn(0):u.start(0),"function"==typeof e.ctx.resume&&e.ctx.resume(),u.onended=function(){u.disconnect(0),e._audioUnlocked=!0,document.removeEventListener("touchstart",t,!0),document.removeEventListener("touchend",t,!0),document.removeEventListener("click",t,!0),document.removeEventListener("keydown",t,!0);for(var o=0;o<e._howls.length;o++)e._howls[o]._emit("unlock")}};return document.addEventListener("touchstart",t,!0),document.addEventListener("touchend",t,!0),document.addEventListener("click",t,!0),document.addEventListener("keydown",t,!0),e}},_obtainHtml5Audio:function(){var e=this||i;if(e._html5AudioPool.length)return e._html5AudioPool.pop();var t=(new Audio).play();return t&&"undefined"!=typeof Promise&&(t instanceof Promise||"function"==typeof t.then)&&t.catch((function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")})),new Audio},_releaseHtml5Audio:function(e){var t=this||i;return e._unlocked&&t._html5AudioPool.push(e),t},_autoSuspend:function(){var e=this;if(e.autoSuspend&&e.ctx&&void 0!==e.ctx.suspend&&i.usingWebAudio){for(var t=0;t<e._howls.length;t++)if(e._howls[t]._webAudio)for(var o=0;o<e._howls[t]._sounds.length;o++)if(!e._howls[t]._sounds[o]._paused)return e;return e._suspendTimer&&clearTimeout(e._suspendTimer),e._suspendTimer=setTimeout((function(){if(e.autoSuspend){e._suspendTimer=null,e.state="suspending";var t=function(){e.state="suspended",e._resumeAfterSuspend&&(delete e._resumeAfterSuspend,e._autoResume())};e.ctx.suspend().then(t,t)}}),3e4),e}},_autoResume:function(){var e=this;if(e.ctx&&void 0!==e.ctx.resume&&i.usingWebAudio)return"running"===e.state&&"interrupted"!==e.ctx.state&&e._suspendTimer?(clearTimeout(e._suspendTimer),e._suspendTimer=null):"suspended"===e.state||"running"===e.state&&"interrupted"===e.ctx.state?(e.ctx.resume().then((function(){e.state="running";for(var t=0;t<e._howls.length;t++)e._howls[t]._emit("resume")})),e._suspendTimer&&(clearTimeout(e._suspendTimer),e._suspendTimer=null)):"suspending"===e.state&&(e._resumeAfterSuspend=!0),e}};var i=new s,r=function(e){e.src&&0!==e.src.length?this.init(e):console.error("An array of source files must be passed with any new Howl.")};r.prototype={init:function(e){var t=this;return i.ctx||h(),t._autoplay=e.autoplay||!1,t._format="string"!=typeof e.format?e.format:[e.format],t._html5=e.html5||!1,t._muted=e.mute||!1,t._loop=e.loop||!1,t._pool=e.pool||5,t._preload="boolean"!=typeof e.preload&&"metadata"!==e.preload||e.preload,t._rate=e.rate||1,t._sprite=e.sprite||{},t._src="string"!=typeof e.src?e.src:[e.src],t._volume=void 0!==e.volume?e.volume:1,t._xhr={method:e.xhr&&e.xhr.method?e.xhr.method:"GET",headers:e.xhr&&e.xhr.headers?e.xhr.headers:null,withCredentials:!(!e.xhr||!e.xhr.withCredentials)&&e.xhr.withCredentials},t._duration=0,t._state="unloaded",t._sounds=[],t._endTimers={},t._queue=[],t._playLock=!1,t._onend=e.onend?[{fn:e.onend}]:[],t._onfade=e.onfade?[{fn:e.onfade}]:[],t._onload=e.onload?[{fn:e.onload}]:[],t._onloaderror=e.onloaderror?[{fn:e.onloaderror}]:[],t._onplayerror=e.onplayerror?[{fn:e.onplayerror}]:[],t._onpause=e.onpause?[{fn:e.onpause}]:[],t._onplay=e.onplay?[{fn:e.onplay}]:[],t._onstop=e.onstop?[{fn:e.onstop}]:[],t._onmute=e.onmute?[{fn:e.onmute}]:[],t._onvolume=e.onvolume?[{fn:e.onvolume}]:[],t._onrate=e.onrate?[{fn:e.onrate}]:[],t._onseek=e.onseek?[{fn:e.onseek}]:[],t._onunlock=e.onunlock?[{fn:e.onunlock}]:[],t._onresume=[],t._webAudio=i.usingWebAudio&&!t._html5,void 0!==i.ctx&&i.ctx&&i.autoUnlock&&i._unlockAudio(),i._howls.push(t),t._autoplay&&t._queue.push({event:"play",action:function(){t.play()}}),t._preload&&"none"!==t._preload&&t.load(),t},load:function(){var e=this,t=null;if(!i.noAudio){"string"==typeof e._src&&(e._src=[e._src]);for(var o=0;o<e._src.length;o++){var n,s;if(e._format&&e._format[o])n=e._format[o];else{if("string"!=typeof(s=e._src[o])){e._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}(n=/^data:audio\/([^;,]+);/i.exec(s))||(n=/\.([^.]+)$/.exec(s.split("?",1)[0])),n&&(n=n[1].toLowerCase())}if(n||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),n&&i.codecs(n)){t=e._src[o];break}}return t?(e._src=t,e._state="loading","https:"===window.location.protocol&&"http:"===t.slice(0,5)&&(e._html5=!0,e._webAudio=!1),new a(e),e._webAudio&&d(e),e):void e._emit("loaderror",null,"No codec support for selected audio sources.")}e._emit("loaderror",null,"No audio support.")},play:function(e,t){var o=this,n=null;if("number"==typeof e)n=e,e=null;else{if("string"==typeof e&&"loaded"===o._state&&!o._sprite[e])return null;if(void 0===e&&(e="__default",!o._playLock)){for(var s=0,r=0;r<o._sounds.length;r++)o._sounds[r]._paused&&!o._sounds[r]._ended&&(s++,n=o._sounds[r]._id);1===s?e=null:n=null}}var a=n?o._soundById(n):o._inactiveSound();if(!a)return null;if(n&&!e&&(e=a._sprite||"__default"),"loaded"!==o._state){a._sprite=e,a._ended=!1;var u=a._id;return o._queue.push({event:"play",action:function(){o.play(u)}}),u}if(n&&!a._paused)return t||o._loadQueue("play"),a._id;o._webAudio&&i._autoResume();var d=Math.max(0,a._seek>0?a._seek:o._sprite[e][0]/1e3),l=Math.max(0,(o._sprite[e][0]+o._sprite[e][1])/1e3-d),c=1e3*l/Math.abs(a._rate),_=o._sprite[e][0]/1e3,h=(o._sprite[e][0]+o._sprite[e][1])/1e3;a._sprite=e,a._ended=!1;var f=function(){a._paused=!1,a._seek=d,a._start=_,a._stop=h,a._loop=!(!a._loop&&!o._sprite[e][2])};if(!(d>=h)){var p=a._node;if(o._webAudio){var m=function(){o._playLock=!1,f(),o._refreshBuffer(a);var e=a._muted||o._muted?0:a._volume;p.gain.setValueAtTime(e,i.ctx.currentTime),a._playStart=i.ctx.currentTime,void 0===p.bufferSource.start?a._loop?p.bufferSource.noteGrainOn(0,d,86400):p.bufferSource.noteGrainOn(0,d,l):a._loop?p.bufferSource.start(0,d,86400):p.bufferSource.start(0,d,l),c!==1/0&&(o._endTimers[a._id]=setTimeout(o._ended.bind(o,a),c)),t||setTimeout((function(){o._emit("play",a._id),o._loadQueue()}),0)};"running"===i.state&&"interrupted"!==i.ctx.state?m():(o._playLock=!0,o.once("resume",m),o._clearTimer(a._id))}else{var v=function(){p.currentTime=d,p.muted=a._muted||o._muted||i._muted||p.muted,p.volume=a._volume*i.volume(),p.playbackRate=a._rate;try{var n=p.play();if(n&&"undefined"!=typeof Promise&&(n instanceof Promise||"function"==typeof n.then)?(o._playLock=!0,f(),n.then((function(){o._playLock=!1,p._unlocked=!0,t?o._loadQueue():o._emit("play",a._id)})).catch((function(){o._playLock=!1,o._emit("playerror",a._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),a._ended=!0,a._paused=!0}))):t||(o._playLock=!1,f(),o._emit("play",a._id)),p.playbackRate=a._rate,p.paused)return void o._emit("playerror",a._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");"__default"!==e||a._loop?o._endTimers[a._id]=setTimeout(o._ended.bind(o,a),c):(o._endTimers[a._id]=function(){o._ended(a),p.removeEventListener("ended",o._endTimers[a._id],!1)},p.addEventListener("ended",o._endTimers[a._id],!1))}catch(e){o._emit("playerror",a._id,e)}};"data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"===p.src&&(p.src=o._src,p.load());var y=window&&window.ejecta||!p.readyState&&i._navigator.isCocoonJS;if(p.readyState>=3||y)v();else{o._playLock=!0,o._state="loading";var g=function(){o._state="loaded",v(),p.removeEventListener(i._canPlayEvent,g,!1)};p.addEventListener(i._canPlayEvent,g,!1),o._clearTimer(a._id)}}return a._id}o._ended(a)},pause:function(e){var t=this;if("loaded"!==t._state||t._playLock)return t._queue.push({event:"pause",action:function(){t.pause(e)}}),t;for(var o=t._getSoundIds(e),n=0;n<o.length;n++){t._clearTimer(o[n]);var s=t._soundById(o[n]);if(s&&!s._paused&&(s._seek=t.seek(o[n]),s._rateSeek=0,s._paused=!0,t._stopFade(o[n]),s._node))if(t._webAudio){if(!s._node.bufferSource)continue;void 0===s._node.bufferSource.stop?s._node.bufferSource.noteOff(0):s._node.bufferSource.stop(0),t._cleanBuffer(s._node)}else isNaN(s._node.duration)&&s._node.duration!==1/0||s._node.pause();arguments[1]||t._emit("pause",s?s._id:null)}return t},stop:function(e,t){var o=this;if("loaded"!==o._state||o._playLock)return o._queue.push({event:"stop",action:function(){o.stop(e)}}),o;for(var n=o._getSoundIds(e),s=0;s<n.length;s++){o._clearTimer(n[s]);var i=o._soundById(n[s]);i&&(i._seek=i._start||0,i._rateSeek=0,i._paused=!0,i._ended=!0,o._stopFade(n[s]),i._node&&(o._webAudio?i._node.bufferSource&&(void 0===i._node.bufferSource.stop?i._node.bufferSource.noteOff(0):i._node.bufferSource.stop(0),o._cleanBuffer(i._node)):isNaN(i._node.duration)&&i._node.duration!==1/0||(i._node.currentTime=i._start||0,i._node.pause(),i._node.duration===1/0&&o._clearSound(i._node))),t||o._emit("stop",i._id))}return o},mute:function(e,t){var o=this;if("loaded"!==o._state||o._playLock)return o._queue.push({event:"mute",action:function(){o.mute(e,t)}}),o;if(void 0===t){if("boolean"!=typeof e)return o._muted;o._muted=e}for(var n=o._getSoundIds(t),s=0;s<n.length;s++){var r=o._soundById(n[s]);r&&(r._muted=e,r._interval&&o._stopFade(r._id),o._webAudio&&r._node?r._node.gain.setValueAtTime(e?0:r._volume,i.ctx.currentTime):r._node&&(r._node.muted=!!i._muted||e),o._emit("mute",r._id))}return o},volume:function(){var e,t,o,n=this,s=arguments;if(0===s.length)return n._volume;if(1===s.length||2===s.length&&void 0===s[1]?n._getSoundIds().indexOf(s[0])>=0?t=parseInt(s[0],10):e=parseFloat(s[0]):s.length>=2&&(e=parseFloat(s[0]),t=parseInt(s[1],10)),!(void 0!==e&&e>=0&&e<=1))return(o=t?n._soundById(t):n._sounds[0])?o._volume:0;if("loaded"!==n._state||n._playLock)return n._queue.push({event:"volume",action:function(){n.volume.apply(n,s)}}),n;void 0===t&&(n._volume=e),t=n._getSoundIds(t);for(var r=0;r<t.length;r++)(o=n._soundById(t[r]))&&(o._volume=e,s[2]||n._stopFade(t[r]),n._webAudio&&o._node&&!o._muted?o._node.gain.setValueAtTime(e,i.ctx.currentTime):o._node&&!o._muted&&(o._node.volume=e*i.volume()),n._emit("volume",o._id));return n},fade:function(e,t,o,n){var s=this;if("loaded"!==s._state||s._playLock)return s._queue.push({event:"fade",action:function(){s.fade(e,t,o,n)}}),s;e=Math.min(Math.max(0,parseFloat(e)),1),t=Math.min(Math.max(0,parseFloat(t)),1),o=parseFloat(o),s.volume(e,n);for(var r=s._getSoundIds(n),a=0;a<r.length;a++){var u=s._soundById(r[a]);if(u){if(n||s._stopFade(r[a]),s._webAudio&&!u._muted){var d=i.ctx.currentTime,l=d+o/1e3;u._volume=e,u._node.gain.setValueAtTime(e,d),u._node.gain.linearRampToValueAtTime(t,l)}s._startFadeInterval(u,e,t,o,r[a],void 0===n)}}return s},_startFadeInterval:function(e,t,o,n,s,i){var r=this,a=t,u=o-t,d=Math.abs(u/.01),l=Math.max(4,d>0?n/d:n),c=Date.now();e._fadeTo=o,e._interval=setInterval((function(){var s=(Date.now()-c)/n;c=Date.now(),a+=u*s,a=Math.round(100*a)/100,a=u<0?Math.max(o,a):Math.min(o,a),r._webAudio?e._volume=a:r.volume(a,e._id,!0),i&&(r._volume=a),(o<t&&a<=o||o>t&&a>=o)&&(clearInterval(e._interval),e._interval=null,e._fadeTo=null,r.volume(o,e._id),r._emit("fade",e._id))}),l)},_stopFade:function(e){var t=this,o=t._soundById(e);return o&&o._interval&&(t._webAudio&&o._node.gain.cancelScheduledValues(i.ctx.currentTime),clearInterval(o._interval),o._interval=null,t.volume(o._fadeTo,e),o._fadeTo=null,t._emit("fade",e)),t},loop:function(){var e,t,o,n=this,s=arguments;if(0===s.length)return n._loop;if(1===s.length){if("boolean"!=typeof s[0])return!!(o=n._soundById(parseInt(s[0],10)))&&o._loop;e=s[0],n._loop=e}else 2===s.length&&(e=s[0],t=parseInt(s[1],10));for(var i=n._getSoundIds(t),r=0;r<i.length;r++)(o=n._soundById(i[r]))&&(o._loop=e,n._webAudio&&o._node&&o._node.bufferSource&&(o._node.bufferSource.loop=e,e&&(o._node.bufferSource.loopStart=o._start||0,o._node.bufferSource.loopEnd=o._stop,n.playing(i[r])&&(n.pause(i[r],!0),n.play(i[r],!0)))));return n},rate:function(){var e,t,o,n=this,s=arguments;if(0===s.length)t=n._sounds[0]._id;else if(1===s.length){var r=n._getSoundIds(),a=r.indexOf(s[0]);a>=0?t=parseInt(s[0],10):e=parseFloat(s[0])}else 2===s.length&&(e=parseFloat(s[0]),t=parseInt(s[1],10));if("number"!=typeof e)return(o=n._soundById(t))?o._rate:n._rate;if("loaded"!==n._state||n._playLock)return n._queue.push({event:"rate",action:function(){n.rate.apply(n,s)}}),n;void 0===t&&(n._rate=e),t=n._getSoundIds(t);for(var u=0;u<t.length;u++)if(o=n._soundById(t[u])){n.playing(t[u])&&(o._rateSeek=n.seek(t[u]),o._playStart=n._webAudio?i.ctx.currentTime:o._playStart),o._rate=e,n._webAudio&&o._node&&o._node.bufferSource?o._node.bufferSource.playbackRate.setValueAtTime(e,i.ctx.currentTime):o._node&&(o._node.playbackRate=e);var d=n.seek(t[u]),l=(n._sprite[o._sprite][0]+n._sprite[o._sprite][1])/1e3-d,c=1e3*l/Math.abs(o._rate);!n._endTimers[t[u]]&&o._paused||(n._clearTimer(t[u]),n._endTimers[t[u]]=setTimeout(n._ended.bind(n,o),c)),n._emit("rate",o._id)}return n},seek:function(){var e,t,o=this,n=arguments;if(0===n.length)o._sounds.length&&(t=o._sounds[0]._id);else if(1===n.length){var s=o._getSoundIds(),r=s.indexOf(n[0]);r>=0?t=parseInt(n[0],10):o._sounds.length&&(t=o._sounds[0]._id,e=parseFloat(n[0]))}else 2===n.length&&(e=parseFloat(n[0]),t=parseInt(n[1],10));if(void 0===t)return 0;if("number"==typeof e&&("loaded"!==o._state||o._playLock))return o._queue.push({event:"seek",action:function(){o.seek.apply(o,n)}}),o;var a=o._soundById(t);if(a){if(!("number"==typeof e&&e>=0)){if(o._webAudio){var u=o.playing(t)?i.ctx.currentTime-a._playStart:0,d=a._rateSeek?a._rateSeek-a._seek:0;return a._seek+(d+u*Math.abs(a._rate))}return a._node.currentTime}var l=o.playing(t);l&&o.pause(t,!0),a._seek=e,a._ended=!1,o._clearTimer(t),o._webAudio||!a._node||isNaN(a._node.duration)||(a._node.currentTime=e);var c=function(){l&&o.play(t,!0),o._emit("seek",t)};if(l&&!o._webAudio){var _=function(){o._playLock?setTimeout(_,0):c()};setTimeout(_,0)}else c()}return o},playing:function(e){var t=this;if("number"==typeof e){var o=t._soundById(e);return!!o&&!o._paused}for(var n=0;n<t._sounds.length;n++)if(!t._sounds[n]._paused)return!0;return!1},duration:function(e){var t=this,o=t._duration,n=t._soundById(e);return n&&(o=t._sprite[n._sprite][1]/1e3),o},state:function(){return this._state},unload:function(){for(var e=this,t=e._sounds,o=0;o<t.length;o++)t[o]._paused||e.stop(t[o]._id),e._webAudio||(e._clearSound(t[o]._node),t[o]._node.removeEventListener("error",t[o]._errorFn,!1),t[o]._node.removeEventListener(i._canPlayEvent,t[o]._loadFn,!1),t[o]._node.removeEventListener("ended",t[o]._endFn,!1),i._releaseHtml5Audio(t[o]._node)),delete t[o]._node,e._clearTimer(t[o]._id);var n=i._howls.indexOf(e);n>=0&&i._howls.splice(n,1);var s=!0;for(o=0;o<i._howls.length;o++)if(i._howls[o]._src===e._src||e._src.indexOf(i._howls[o]._src)>=0){s=!1;break}return u&&s&&delete u[e._src],i.noAudio=!1,e._state="unloaded",e._sounds=[],e=null,null},on:function(e,t,o,n){var s=this["_on"+e];return"function"==typeof t&&s.push(n?{id:o,fn:t,once:n}:{id:o,fn:t}),this},off:function(e,t,o){var n=this,s=n["_on"+e],i=0;if("number"==typeof t&&(o=t,t=null),t||o)for(i=0;i<s.length;i++){var r=o===s[i].id;if(t===s[i].fn&&r||!t&&r){s.splice(i,1);break}}else if(e)n["_on"+e]=[];else{var a=Object.keys(n);for(i=0;i<a.length;i++)0===a[i].indexOf("_on")&&Array.isArray(n[a[i]])&&(n[a[i]]=[])}return n},once:function(e,t,o){return this.on(e,t,o,1),this},_emit:function(e,t,o){for(var n=this,s=n["_on"+e],i=s.length-1;i>=0;i--)s[i].id&&s[i].id!==t&&"load"!==e||(setTimeout(function(e){e.call(this,t,o)}.bind(n,s[i].fn),0),s[i].once&&n.off(e,s[i].fn,s[i].id));return n._loadQueue(e),n},_loadQueue:function(e){var t=this;if(t._queue.length>0){var o=t._queue[0];o.event===e&&(t._queue.shift(),t._loadQueue()),e||o.action()}return t},_ended:function(e){var t=this,o=e._sprite;if(!t._webAudio&&e._node&&!e._node.paused&&!e._node.ended&&e._node.currentTime<e._stop)return setTimeout(t._ended.bind(t,e),100),t;var n=!(!e._loop&&!t._sprite[o][2]);if(t._emit("end",e._id),!t._webAudio&&n&&t.stop(e._id,!0).play(e._id),t._webAudio&&n){t._emit("play",e._id),e._seek=e._start||0,e._rateSeek=0,e._playStart=i.ctx.currentTime;var s=1e3*(e._stop-e._start)/Math.abs(e._rate);t._endTimers[e._id]=setTimeout(t._ended.bind(t,e),s)}return t._webAudio&&!n&&(e._paused=!0,e._ended=!0,e._seek=e._start||0,e._rateSeek=0,t._clearTimer(e._id),t._cleanBuffer(e._node),i._autoSuspend()),t._webAudio||n||t.stop(e._id,!0),t},_clearTimer:function(e){var t=this;if(t._endTimers[e]){if("function"!=typeof t._endTimers[e])clearTimeout(t._endTimers[e]);else{var o=t._soundById(e);o&&o._node&&o._node.removeEventListener("ended",t._endTimers[e],!1)}delete t._endTimers[e]}return t},_soundById:function(e){for(var t=this,o=0;o<t._sounds.length;o++)if(e===t._sounds[o]._id)return t._sounds[o];return null},_inactiveSound:function(){var e=this;e._drain();for(var t=0;t<e._sounds.length;t++)if(e._sounds[t]._ended)return e._sounds[t].reset();return new a(e)},_drain:function(){var e=this,t=e._pool,o=0,n=0;if(!(e._sounds.length<t)){for(n=0;n<e._sounds.length;n++)e._sounds[n]._ended&&o++;for(n=e._sounds.length-1;n>=0;n--){if(o<=t)return;e._sounds[n]._ended&&(e._webAudio&&e._sounds[n]._node&&e._sounds[n]._node.disconnect(0),e._sounds.splice(n,1),o--)}}},_getSoundIds:function(e){if(void 0===e){for(var t=[],o=0;o<this._sounds.length;o++)t.push(this._sounds[o]._id);return t}return[e]},_refreshBuffer:function(e){return e._node.bufferSource=i.ctx.createBufferSource(),e._node.bufferSource.buffer=u[this._src],e._panner?e._node.bufferSource.connect(e._panner):e._node.bufferSource.connect(e._node),e._node.bufferSource.loop=e._loop,e._loop&&(e._node.bufferSource.loopStart=e._start||0,e._node.bufferSource.loopEnd=e._stop||0),e._node.bufferSource.playbackRate.setValueAtTime(e._rate,i.ctx.currentTime),this},_cleanBuffer:function(e){var t=i._navigator&&i._navigator.vendor.indexOf("Apple")>=0;if(i._scratchBuffer&&e.bufferSource&&(e.bufferSource.onended=null,e.bufferSource.disconnect(0),t))try{e.bufferSource.buffer=i._scratchBuffer}catch(e){}return e.bufferSource=null,this},_clearSound:function(e){/MSIE |Trident\//.test(i._navigator&&i._navigator.userAgent)||(e.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var a=function(e){this._parent=e,this.init()};a.prototype={init:function(){var e=this,t=e._parent;return e._muted=t._muted,e._loop=t._loop,e._volume=t._volume,e._rate=t._rate,e._seek=0,e._paused=!0,e._ended=!0,e._sprite="__default",e._id=++i._counter,t._sounds.push(e),e.create(),e},create:function(){var e=this,t=e._parent,o=i._muted||e._muted||e._parent._muted?0:e._volume;return t._webAudio?(e._node=void 0===i.ctx.createGain?i.ctx.createGainNode():i.ctx.createGain(),e._node.gain.setValueAtTime(o,i.ctx.currentTime),e._node.paused=!0,e._node.connect(i.masterGain)):i.noAudio||(e._node=i._obtainHtml5Audio(),e._errorFn=e._errorListener.bind(e),e._node.addEventListener("error",e._errorFn,!1),e._loadFn=e._loadListener.bind(e),e._node.addEventListener(i._canPlayEvent,e._loadFn,!1),e._endFn=e._endListener.bind(e),e._node.addEventListener("ended",e._endFn,!1),e._node.src=t._src,e._node.preload=!0===t._preload?"auto":t._preload,e._node.volume=o*i.volume(),e._node.load()),e},reset:function(){var e=this,t=e._parent;return e._muted=t._muted,e._loop=t._loop,e._volume=t._volume,e._rate=t._rate,e._seek=0,e._rateSeek=0,e._paused=!0,e._ended=!0,e._sprite="__default",e._id=++i._counter,e},_errorListener:function(){var e=this;e._parent._emit("loaderror",e._id,e._node.error?e._node.error.code:0),e._node.removeEventListener("error",e._errorFn,!1)},_loadListener:function(){var e=this,t=e._parent;t._duration=Math.ceil(10*e._node.duration)/10,0===Object.keys(t._sprite).length&&(t._sprite={__default:[0,1e3*t._duration]}),"loaded"!==t._state&&(t._state="loaded",t._emit("load"),t._loadQueue()),e._node.removeEventListener(i._canPlayEvent,e._loadFn,!1)},_endListener:function(){var e=this,t=e._parent;t._duration===1/0&&(t._duration=Math.ceil(10*e._node.duration)/10,t._sprite.__default[1]===1/0&&(t._sprite.__default[1]=1e3*t._duration),t._ended(e)),e._node.removeEventListener("ended",e._endFn,!1)}};var u={},d=function(e){var t=e._src;if(u[t])return e._duration=u[t].duration,void _(e);if(/^data:[^;]+;base64,/.test(t)){for(var o=atob(t.split(",")[1]),n=new Uint8Array(o.length),s=0;s<o.length;++s)n[s]=o.charCodeAt(s);c(n.buffer,e)}else{var i=new XMLHttpRequest;i.open(e._xhr.method,t,!0),i.withCredentials=e._xhr.withCredentials,i.responseType="arraybuffer",e._xhr.headers&&Object.keys(e._xhr.headers).forEach((function(t){i.setRequestHeader(t,e._xhr.headers[t])})),i.onload=function(){var t=(i.status+"")[0];"0"===t||"2"===t||"3"===t?c(i.response,e):e._emit("loaderror",null,"Failed loading audio file with status: "+i.status+".")},i.onerror=function(){e._webAudio&&(e._html5=!0,e._webAudio=!1,e._sounds=[],delete u[t],e.load())},l(i)}},l=function(e){try{e.send()}catch(t){e.onerror()}},c=function(e,t){var o=function(){t._emit("loaderror",null,"Decoding audio data failed.")},n=function(e){e&&t._sounds.length>0?(u[t._src]=e,_(t,e)):o()};"undefined"!=typeof Promise&&1===i.ctx.decodeAudioData.length?i.ctx.decodeAudioData(e).then(n).catch(o):i.ctx.decodeAudioData(e,n,o)},_=function(e,t){t&&!e._duration&&(e._duration=t.duration),0===Object.keys(e._sprite).length&&(e._sprite={__default:[0,1e3*e._duration]}),"loaded"!==e._state&&(e._state="loaded",e._emit("load"),e._loadQueue())},h=function(){if(i.usingWebAudio){try{"undefined"!=typeof AudioContext?i.ctx=new AudioContext:"undefined"!=typeof webkitAudioContext?i.ctx=new webkitAudioContext:i.usingWebAudio=!1}catch(e){i.usingWebAudio=!1}i.ctx||(i.usingWebAudio=!1);var e=/iP(hone|od|ad)/.test(i._navigator&&i._navigator.platform),t=i._navigator&&i._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),o=t?parseInt(t[1],10):null;if(e&&o&&o<9){var n=/safari/.test(i._navigator&&i._navigator.userAgent.toLowerCase());i._navigator&&!n&&(i.usingWebAudio=!1)}i.usingWebAudio&&(i.masterGain=void 0===i.ctx.createGain?i.ctx.createGainNode():i.ctx.createGain(),i.masterGain.gain.setValueAtTime(i._muted?0:i._volume,i.ctx.currentTime),i.masterGain.connect(i.ctx.destination)),i._setup()}};void 0!==(n=function(){return{Howler:i,Howl:r}}.apply(t,[]))&&(e.exports=n),void 0!==o.g?(o.g.HowlerGlobal=s,o.g.Howler=i,o.g.Howl=r,o.g.Sound=a):"undefined"!=typeof window&&(window.HowlerGlobal=s,window.Howler=i,window.Howl=r,window.Sound=a)}()}},t={};function o(n){var s=t[n];if(void 0!==s)return s.exports;var i=t[n]={exports:{}};return e[n](i,i.exports,o),i.exports}o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var n={};(()=>{"use strict";function e(e,t){return e+Math.round(Math.random()*(t-e))}function t(e,t){return e+Math.random()*(t-e)}o.d(n,{e:()=>F});class s{static new(e,t){return{x:e,y:t}}static from_angle(e,t=1){return{x:Math.cos(e)*t,y:Math.sin(e)*t}}static angle(e){return Math.atan(e.y/e.x)+Math.PI*(e.x<0)}static add(e,t,o){if(void 0===o)return"number"==typeof t?(e.x+=t,void(e.y+=t)):(e.x+=t.x,void(e.y+=t.y));e.x+=t,e.y+=o}static sub(e,t,o){if(void 0===o)return"number"==typeof t?(e.x-=t,void(e.y-=t)):(e.x-=t.x,void(e.y-=t.y));e.x-=t,e.y-=o}static c_add(e,t,o){const n=s.copy(e);return s.add(n,t,o),n}static pow(e,t,o){if(void 0===o)return"number"==typeof t?(e.x**=t,void(e.y**=t)):(e.x**=t.x,void(e.y**=t.y));e.x**=t,e.y**=o}static mag(e){return Math.sqrt(e.x**2+e.y**2)}static norm(e,t=1){const o=s.mag(e)/t;e.x/=o,e.y/=o}static mult(e,t,o){if(void 0===o)return"number"==typeof t?(e.x*=t,void(e.y*=t)):(e.x*=t.x,void(e.y*=t.y));e.x*=t,e.y*=o}static div(e,t,o){if(void 0===o)return"number"==typeof t?(e.x/=t,void(e.y/=t)):(e.x/=t.x,void(e.y/=t.y));e.x/=t,e.y/=o}static copy(e){return{x:e.x,y:e.y}}}class i{static set(e,t,o){if(o<0||o>15||o%1!=0)throw`Expected int within range 0-15 for Bytewise.set(), received ${o} instead`;const n=4*t;let s=e;return s-=e&15<<n,s+=o<<n,s}static random(t){let o=0;for(let n=0;t>>n>0;n+=4)o+=e(0,t>>n&15)<<n;return o}static get(e,t){return e>>4*t&15}static inc(e,t,o=15){return i.set(e,t,(i.get(e,t)+1)%o)}static dec(e,t,o=15){return i.set(e,t,(i.get(e,t)-1)%o)}static eq(e,t){let o=0;for(let n=0;e>>n>0;n+=4)o+=+((e>>n&15)==(t>>n&15))<<n/4;return o}static add(e,t,o=-1){if(-1==o)return e+t;const n=e|t;let s=0;for(let i=0;n>>i>0;i+=4)s+=((e>>i&15)+(t>>i&15))%o;return s}static star_compare(e,t){let o=0;const n=e|t;for(let s=0;n>>s>0;s+=4){const n=e>>s&15,i=t>>s&15;let r=null;if(n==i?r=n:((0==n&&1==i||0==i&&1==n)&&(r=2),(0==n&&2==i||0==i&&2==n)&&(r=1),(1==n&&2==i||1==i&&2==n)&&(r=0)),null===r)throw`Star comparison critical error! DIGITA=${n}, DIGITB=${i}`;o+=r<<s}return o}}let r=null;const a=128;function u(e,t,o,n,s,u){const d=i.get(t,0)*a,l=i.get(t,2)*a*3+i.get(t,1)*a;if(d>256||l>1024)throw`ValueError: Star has invalid flags! Position resides outside boundaries (${l},${d})`;e.drawImage(r,l,d,a,a,o,n,s,u)}o(973);const d={};globalThis.SOUNDS=d;const l={};function c(e,t){if(!(e in l))throw`ValueError: Attempted to access non-existent channel ${e}`;l[e]=t;for(let o in d)if(d[o].channel===e)for(let e of d[o].howls)e.playing&&e.volume(t)}function _(t){if(!(t in d))throw`ValueError: Attempted to play non-existent sound ${t}`;const o=d[t];if(o.volume*l[o.channel]==0)return;let n=o.volume*l[o.channel];if(o.howls.length>1){let t=e(0,o.howls.length-1);o.howls[t].volume(n),o.howls[t].play()}else o.howls[0].volume(n),o.howls[0].play()}globalThis.CHANNELS=l;class h{hlist=[];hooks={};info={};constructor(){}add(e,t){this.hlist.push(e),this.hooks[e]=t,this.info[e]=null}emit(e,t){this.info[e]=t}serve(){for(let e=0;e<this.hlist.length;e++){const t=this.hlist[e];this.info[t]&&(this.hooks[t](this.info[t]),this.info[t]=null)}}}function f(e){return new Promise((t=>{setTimeout(t,e)}))}!function(e){for(let e of[{name:"connect_succeed",channel:"sfx",sources:[["/assets/sound/connect_succeed1.mp3"],["/assets/sound/connect_succeed2.mp3"],["/assets/sound/connect_succeed3.mp3"]],volume:.5},{name:"connect_fail",channel:"sfx",sources:[["/assets/sound/connect_fail.mp3"]],volume:.5},{name:"complete",channel:"sfx",sources:[["/assets/sound/complete.mp3"]],volume:1},{name:"click",channel:"sfx",sources:[["/assets/sound/click.mp3"]],volume:.4}]){const t=new Array(e.sources.length);for(let o in e.sources)t[o]=new Howl({src:e.sources[o],volume:e.volume});d[e.name]={channel:e.channel,volume:e.volume,howls:t}}}(),function(e){for(let e of[{name:"sfx",volume:.5},{name:"music",volume:1}])l[e.name]=e.volume}();const p=document.querySelector("#background");class m{stars=[];canvas;ctx;space={width:0,height:0};dpi=devicePixelRatio;mouse={x:0,y:0,star_id:null};selection=[];action=0;collected_arr=[];collected=0;difficulty=0;__enable_score=!0;score=0;vscore=0;__events={};__pairstate=[[],new Uint8Array];level_size=[0,5,0];interactloop;static gravity=1;static gamescale=1.75;static motion=0;static colortable=[[168,100,77],[0,0,500],[327,100,68]];static SetColorMode(e){console.warn("SetColorMode is obsolete!"),m.colortable=e}static SetMusicVolume(e){c("music",e)}static SetSFXVolume(e){c("sfx",e)}static SetGameScale(e){m.gamescale=e,console.warn("SetGameScale is non-functional!")}static SetMotionMode(e){p.classList.toggle("no-motion",e>0),m.motion=e}constructor(e){if(this.stars=[],this.canvas=e,this.ctx=this.canvas.getContext("2d"),null===this.ctx)throw"Context is null! This should never happen.";this.interactloop=new h,this.interactloop.add("mousemove",(e=>this.onmousemove(e))),this.interactloop.add("mousedown",(e=>this.onmousedown(e))),this.canvas.addEventListener("mousemove",(e=>this.interactloop.emit("mousemove",e))),this.canvas.addEventListener("mousedown",(e=>this.interactloop.emit("mousedown",e)))}resize(){const e=this.canvas.clientWidth-this.space.width,t=this.canvas.clientHeight-this.space.height,o=s.new(e/2,t/2);this.stars.forEach((e=>{s.add(e,o)})),this.canvas.width=this.canvas.clientWidth*this.dpi,this.canvas.height=this.canvas.clientHeight*this.dpi,this.space.width=this.canvas.clientWidth,this.space.height=this.canvas.clientHeight}onmousemove(e){this.mouse.x=e.x,this.mouse.y=e.y,this.mouse.star_id=this.nearest_star(this.mouse,-1,24*m.gamescale)}__analyze_pairs(){const e=[],t=new Set;for(let o=0;o<this.stars.length;o++){let n=this.stars[o];if(!n.collected)for(let s=o+1;s<this.stars.length;s++){let r=this.stars[s];if(r.collected)continue;let a=i.star_compare(n.flags,r.flags);for(let n=s+1;n<this.stars.length;n++){let i=this.stars[n];i.collected||i.flags===a&&(t.add(o),t.add(s),t.add(n),e.push(Uint8Array.of(o,s,n)))}}}const o=new Uint8Array(this.stars.length-t.size-this.collected);let n=0;for(let e=0;e<this.stars.length;e++)t.has(e)||this.stars[e].collected||(o[n]=e,n++);return this.__pairstate=[e,o],this.__pairstate}replenish_pairs(e){const t=new Set,o={},n=new Set;for(let e=0;e<this.stars.length;e++){let s=this.stars[e];if(!s.collected)for(let r=e+1;r<this.stars.length;r++){let e=this.stars[r];if(e.collected||n.has(r))continue;let a=i.star_compare(s.flags,e.flags),u=!1;for(let e=r+1;e<this.stars.length;e++){let t=this.stars[e];if(!t.collected&&t.flags==a&&!n.has(e)){u=!0;break}}u?(n.add(s),n.add(e),n.add(a)):(n.add(e),t.add(a),o[a]=(o[a]||0)+1)}}const s=Math.round((0,1,1,(e-0)/1*(t.size-1)+1));const r=Array.from(t).sort(((e,t)=>o[t]>o[e])),a=new Array(3);for(let e=0;e<3;e++)e+s-1<t.size?a[e]=this.__createStar(r[e+s-1]):a[e]=this.__createStar(i.random(546));return Array.prototype.push.apply(this.stars,a),a}repair_broken_pairs(){const e=this.__pairstate[1].length,t=Math.floor(e/2)+e%2*2,o=new Array(t);for(let t=0;t<Math.floor(e/2);t++){const e=this.__pairstate[1][2*t+0],n=this.__pairstate[1][2*t+1];o[t]=this.__createStar(i.star_compare(this.stars[e].flags,this.stars[n].flags))}if(e%2){const e=t-2,n=i.random(273),s=this.stars[e].flags;o[e+1]=this.__createStar(i.add(s,1*n,2)),o[e+2]=this.__createStar(i.add(s,2*n,2))}Array.prototype.push.apply(this.stars,o)}check_pair(e){const t=new Array(3);for(let o=0;o<3;o++){t[o]=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[o][n]=i.get(this.stars[this.selection[n]].flags,o);const n=new Set(t[o]);if(1!==n.size&&n.size!==e.length)return!1}return!0}onmousedown(e){this.mouse.x=e.x,this.mouse.y=e.y;let t=this.nearest_star(this.mouse,-1,24*m.gamescale);if(null===t)return this.selection=[],void(this.action=0);if(1===this.action){if(this.selection.includes(t))return;if(_("click"),this.selection.push(t),3==this.selection.length){if(!this.check_pair(this.selection))return this.selection=[],this.action=0,void _("connect_fail");this.collected+=this.selection.length,Array.prototype.push.apply(this.collected_arr,this.selection);for(let e=0;e<this.selection.length;e++)this.stars[this.selection[e]].collected=!0;this.collected==this.stars.length&&(_("complete"),this.__fire_event("pre_complete")&&this.next_stage()),_("connect_succeed"),this.__enable_score&&(this.score+=this.determine_score(this.selection)),this.__analyze_pairs(),this.selection=[],this.action=0,this.__pairstate[1].length&&this.repair_broken_pairs()}}else _("click"),this.selection=[t],this.action=1}nearest_star(e,t=-1,o=0){if(0==this.stars.length)return null;const n=new Uint16Array(this.stars.length);let s=null;for(let o=0;o<this.stars.length;o++)n[o]=Math.min((e.x-this.stars[o].x)**2+(e.y-this.stars[o].y)**2,65535),t!==o&&(n[o]<s||null===s)&&!this.stars[o].collected&&(s=n[o]);return null===s||o&&s>o**2?null:n.indexOf(s)}clear_stage(){this.stars=[],this.selection=[],this.collected=0,this.collected_arr=[]}hook(e,t){this.__events[e]=t}unhook(e){e in this.__events&&delete this.__events[e]}__fire_event(e){return!(e in this.__events)||this.__events[e](this)}determine_score(e){let t=50;const o=i.eq(this.stars[e[0]].flags,this.stars[e[1]].flags);return o>>2||(t+=20),o>>1||(t+=30),o>>0||(t+=40),t}async next_stage(){if(await f(500),this.clear_stage(),this.generate_random(...this.level_size),this.__pairstate[1]=new Uint8Array,m.motion>0){for(let e=0;e<50;e++)this.physics(20,!0);this.settle_stars(m.motion<2)}else this.settle_stars(!0)}__createStar(e){const o=this.space;return(n={x:0,y:0,flags:e,velx:0,vely:0,collected:!1,visx:0,visy:0,vscale:2,opacity:100}).x=t(.1,.9)*o.width,n.y=t(.1,.9)*o.height,n;var n}generate_random(t,o,n){this.space;const s=[];for(let t=0;t<o;t++){const t=3,o=new Array(t),n=e(0,7);let r=i.random(546);for(let e=0;e<t;e++){o[e]=this.__createStar(r);for(let e=0;e<3;e++)n>>e&1&&(r=i.inc(r,e,i.get(819,e)))}s.push(o)}const r=new Array(t);for(let e=0;e<t;e++)r[e]=this.__createStar(i.random(546));if(o){const e=s.reduce(((e,t)=>e.concat(t)));Array.prototype.push.apply(this.stars,e)}Array.prototype.push.apply(this.stars,r)}settle_stars(e){const t=s.new(this.space.width/2,this.space.height/2);if(e)for(let e of this.stars)e.visx=1.4*(e.x-t.x)+t.x,e.visy=1.4*(e.y-t.y)+t.y;else for(let e of this.stars)e.visx=e.x,e.visy=e.y}physics(e,t=!1){this.interactloop.serve();const o=0==m.motion||t,n=s.new(this.space.width/2,this.space.height/2);if(2!=m.motion||t)for(let t=0;t<this.stars.length;t++){const i=this.stars[t];if(i.collected)i.opacity>0&&(i.opacity=.85*i.opacity-1,i.x=(6*i.x+n.x)/7,i.y=(6*i.y+n.y)/7);else{if(!o)continue;const n=s.new(i.x-this.space.width/2,i.y-this.space.height/2),r=.2/s.mag(n)**.6+.03;s.mult(n,-1e-4*m.gravity),i.velx+=n.x,i.vely+=n.y;const a=s.from_angle(s.angle(n)+1.571+.2,r);i.velx+=a.x,i.vely+=a.y;const u=this.nearest_star(i,t,72);if(null!==u){const e=s.copy(i);s.sub(e,this.stars[u]);const t=s.mag(e);s.norm(e,(96-t)/400),i.velx+=e.x,i.vely+=e.y}i.velx*=.9,i.vely*=.9,i.x+=i.velx*e,i.y+=i.vely*e}}else for(let e of this.stars)e.collected&&e.opacity>0&&(e.opacity-=5)}render(){const e=this.ctx;if(e.clearRect(0,0,this.canvas.width,this.canvas.height),this.selection.length){e.strokeStyle="#888",e.lineWidth=this.dpi,e.beginPath();const t=this.selection[0];e.moveTo(this.stars[t].visx*this.dpi,this.stars[t].visy*this.dpi);for(let t=1;t<this.selection.length;t++)e.lineTo(this.stars[this.selection[t]].visx*this.dpi,this.stars[this.selection[t]].visy*this.dpi);null===this.mouse.star_id?e.lineTo(this.mouse.x*this.dpi,this.mouse.y*this.dpi):e.lineTo(this.stars[this.mouse.star_id].x*this.dpi,this.stars[this.mouse.star_id].y*this.dpi),e.stroke()}for(let t=0;t<this.stars.length;t++){const o=this.stars[t];if(o.opacity<=0)continue;let n=s.new(o.x-this.mouse.x,o.y-this.mouse.y);s.mult(n,-.04*(null!==this.mouse.star_id&&this.mouse.star_id!==t));let i=s.new(o.x,o.y),r=1;this.selection.includes(t)&&(r=1.3,s.add(i,n)),o.visx=(2*o.visx+i.x)/3,o.visy=(2*o.visy+i.y)/3,o.vscale=(2*o.vscale+r)/3;const a=32*o.vscale;e.globalAlpha=o.opacity/100;const d=s.new(o.visx,o.visy),l=a*this.dpi*m.gamescale;s.mult(d,this.dpi),u(e,o.flags,d.x-l/2,d.y-l/2,l,l)}if(this.__enable_score){this.vscore<this.score&&this.vscore++,this.vscore>this.score&&(this.vscore=this.score);const t=this.canvas.width/2;e.globalAlpha=1,e.textBaseline="top",e.fillStyle="#888",e.textAlign="right",e.font=`bold ${15*this.dpi}px "Helvetica Neue"`,e.fillText("SCORE",t-5,10*this.dpi),e.textAlign="left",e.font=`lighter ${15*this.dpi}px "Helvetica Neue"`,e.fillText(this.vscore.toFixed(0),t+5,10*this.dpi)}}}const v=document.querySelector("#tutorial"),y=[{1:"Hello, this is a game about connecting dots.",2:"",3:"The rules are simple -",4:"",5:"A set is composed of three stars that,",6:"for every charactaristic,",7:"are all equal or are all not equal.",ACT0:function(){F.clear_stage(),F.stars=[F.__createStar(0),F.__createStar(273),F.__createStar(546)],F.settle_stars(!0),F.hook("pre_complete",g)}},{1:"There it is!",2:"It's easy, you'll get the hang of it.",ACT0:async function(){await f(200),F.clear_stage(),F.stars=[F.__createStar(18),F.__createStar(18),F.__createStar(18)],F.settle_stars(!0)}},{1:"Who am I to keep you waiting?",2:"You can do this at your own pace.",ACT0:async function(){await f(300),F.generate_random(0,2,0),F.settle_stars(!0),F.hook("pre_complete",x)}}];function g(){for(w++;v.firstChild;)v.removeChild(v.firstChild);let e=0;for(let t in y[w]){if(t.startsWith("ACT")){y[w][t]();continue}e++;const o=document.createElement("span");o.innerText=y[w][t],v.appendChild(o),setTimeout((()=>{o.classList.add("active")}),500*e)}return!1}let w=0;function x(){return v.classList.remove("active"),F.__enable_score=!0,F.score=0,F.unhook("pre_complete"),!0}const b=document.querySelector("#menu"),A=(document.querySelector("#settings-colormode"),document.querySelector("#settings-motion")),S=document.querySelector("#settings-volume-music"),T=document.querySelector("#settings-volume-sfx");let k=!1;const L={volume_music:1,volume_sfx:1,motion:0},I={volume_music:1,volume_sfx:1,motion:0},P=["Full","Reduced","Minimal"],E={"enter-menu":()=>{b.classList.add("main","active"),k=!0,F.dpi=.5,F.resize()},"main-resume":()=>{b.classList.remove("main","active"),k=!1,F.dpi=devicePixelRatio,F.resize()},"main-settings":()=>{b.classList.remove("main"),b.classList.add("settings"),A.innerText=P[L.motion],S.value=L.volume_music.toString(),T.value=L.volume_sfx.toString()},"main-exit":()=>{},"settings-volume-music":e=>{I.volume_music=Number(e),m.SetMusicVolume(I.volume_music)},"settings-volume-sfx":e=>{I.volume_sfx=Number(e),m.SetSFXVolume(I.volume_sfx)},"settings-game-scale":e=>{m.SetGameScale(Number(e)+1)},"settings-motion-prev":()=>{I.motion>0?I.motion--:I.motion=P.length-1,A.innerText=P[I.motion],m.SetMotionMode(I.motion)},"settings-motion-next":()=>{I.motion<P.length-1?I.motion++:I.motion=0,A.innerText=P[I.motion],m.SetMotionMode(I.motion)},"settings-cancel":()=>{b.classList.remove("settings"),b.classList.add("main"),Object.assign(I,L),B()},"settings-apply":()=>{b.classList.remove("settings"),b.classList.add("main"),Object.assign(L,I),B()}};function B(){m.SetMusicVolume(L.volume_music),m.SetSFXVolume(L.volume_sfx),m.SetMotionMode(L.motion)}document.querySelectorAll("*[data-action]").forEach((e=>{const t=e.getAttribute("data-action");e.addEventListener("click",(()=>{E[t]()}))})),document.querySelectorAll("input[data-value]").forEach((e=>{const t=e.getAttribute("data-value");e.addEventListener("input",(()=>{E[t](e.value)}))}));const M=document.querySelector("canvas");window.addEventListener("resize",(()=>{F.resize()}));const F=globalThis.game=new m(M);F.resize(),(async()=>{await async function(){await async function(e){r=await async function(e){return new Promise(((t,o)=>{let n=new Image;n.onload=()=>{t(n)},n.onerror=e=>{o(e)},n.src=e}))}(e)}("/assets/game/sprites_legacy.png")}(),v.classList.add("active"),w=-1,F.__enable_score=!1,g(),q(0)})();let C=0;function q(e){const t=0|e,o=t-C;C=t,o<800&&(F.physics(o/10),F.render()),requestAnimationFrame(q)}})()})();